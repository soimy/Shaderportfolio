
(function(d) {
    var e = this,
    l = e.document,
    E = d(l),
    t = d(e),
    v = Array.prototype,
    q = !0,
    F = !1,
    x = navigator.userAgent.toLowerCase(),
    C = e.location.hash.replace(/#\//, ""),
    D = function() {},
    z = function() {
        return ! 1
    },
    y = function() {
        var a = 3,
        c = l.createElement("div"),
        d = c.getElementsByTagName("i");
        do c.innerHTML = "<\!--[if gt IE " + ++a + "]><i></i><![endif]--\>";
        while (d[0]);
        return a > 4 ? a: void 0
    } (),
    O = function() {
        return {
            html: l.documentElement,
            body: l.body,
            head: l.getElementsByTagName("head")[0],
            title: l.title
        }
    },
    I = function() {
        var a = [];
        d.each("data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image".split(" "),
        function(c, d) {
            a.push(d);
            /_/.test(d) && a.push(d.replace(/_/g, ""))
        });
        return a
    } (),
    M = function(a) {
        var c;
        if (typeof a !== "object") return a;
        d.each(a,
        function(i, e) { / ^[a - z] + _ / .test(i) && (c = "", d.each(i.split("_"),
            function(a, d) {
                c += a > 0 ? d.substr(0, 1).toUpperCase() + d.substr(1) : d
            }), a[c] = e, delete a[i])
        });
        return a
    },
    U = function(a) {
        if (d.inArray(a, I) > -1) return Galleria[a.toUpperCase()];
        return a
    },
    P = {
        youtube: {
            reg: /https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,
            embed: function(a) {
                return "http://www.youtube.com/embed/" + a
            },
            getThumb: function(a, c, i) {
                i = i || D;
                d.getJSON("http://gdata.youtube.com/feeds/api/videos/" + a + "?v=2&alt=json-in-script&callback=?",
                function(a) {
                    try {
                        c(a.entry.media$group.media$thumbnail[0].url)
                    } catch(d) {
                        i()
                    }
                }).error(i)
            }
        },
        vimeo: {
            reg: /https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,
            embed: function(a) {
                return "http://player.vimeo.com/video/" + a
            },
            getThumb: function(a, c, i) {
                i = i || D;
                d.getJSON("http://vimeo.com/api/v2/video/" + a + ".json?callback=?",
                function(a) {
                    try {
                        c(a[0].thumbnail_medium)
                    } catch(d) {
                        i()
                    }
                }).error(i)
            }
        },
        dailymotion: {
            reg: /https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,
            embed: function(a) {
                return "http://www.dailymotion.com/embed/video/" + a
            },
            getThumb: function(a, c, i) {
                i = i || D;
                d.getJSON("https://api.dailymotion.com/video/" + a + "?fields=thumbnail_medium_url&callback=?",
                function(a) {
                    try {
                        c(a.thumbnail_medium_url)
                    } catch(d) {
                        i()
                    }
                }).error(i)
            }
        }
    },
    Q = function(a) {
        var c, d;
        for (d in P) if ((c = a && a.match(P[d].reg)) && c.length) return {
            id: c[2],
            provider: d
        };
        return ! 1
    },
    L = {
        support: function() {
            var a = O().html;
            return a.requestFullscreen || a.mozRequestFullScreen || a.webkitRequestFullScreen
        } (),
        callback: D,
        enter: function(a, c) {
            this.instance = a;
            this.callback = c || D;
            var d = O().html;
            d.requestFullscreen ? d.requestFullscreen() : d.mozRequestFullScreen ? d.mozRequestFullScreen() : d.webkitRequestFullScreen && d.webkitRequestFullScreen()
        },
        exit: function(a) {
            this.callback = a || D;
            l.exitFullscreen ? l.exitFullscreen() : l.mozCancelFullScreen ? l.mozCancelFullScreen() : l.webkitCancelFullScreen && l.webkitCancelFullScreen()
        },
        instance: null,
        listen: function() {
            if (this.support) {
                var a = function() {
                    if (L.instance) {
                        var a = L.instance._fullscreen;
                        l.fullscreen || l.mozFullScreen || l.webkitIsFullScreen ? a._enter(L.callback) : a._exit(L.callback)
                    }
                };
                l.addEventListener("fullscreenchange", a, !1);
                l.addEventListener("mozfullscreenchange", a, !1);
                l.addEventListener("webkitfullscreenchange", a, !1)
            }
        }
    },
    W = [],
    X = [],
    aa = !1,
    R = !1,
    la = [],
    ha = function(a) {
        Galleria.theme = a;
        d.each(la,
        function(a, d) {
            d._initialized || d._init.call(d)
        })
    },
    k = function() {
        return {
            clearTimer: function(a) {
                d.each(Galleria.get(),
                function() {
                    this.clearTimer(a)
                })
            },
            addTimer: function(a) {
                d.each(Galleria.get(),
                function() {
                    this.addTimer(a)
                })
            },
            array: function(a) {
                return v.slice.call(a, 0)
            },
            create: function(a, c) {
                var d = l.createElement(c || "div");
                d.className = a;
                return d
            },
            getScriptPath: function(a) {
                a = a || d("script:last").attr("src");
                a = a.split("/");
                if (a.length == 1) return "";
                a.pop();
                return a.join("/") + "/"
            },
            animate: function() {
                var a = function(a) {
                    var c = "transition WebkitTransition MozTransition OTransition".split(" "),
                    d;
                    if (e.opera) return ! 1;
                    for (d = 0; c[d]; d++) if (typeof a[c[d]] !== "undefined") return c[d];
                    return ! 1
                } ((l.body || l.documentElement).style),
                c = {
                    MozTransition: "transitionend",
                    OTransition: "oTransitionEnd",
                    WebkitTransition: "webkitTransitionEnd",
                    transition: "transitionend"
                } [a],
                i = {
                    _default: [0.25, 0.1, 0.25, 1],
                    galleria: [0.645, 0.045, 0.355, 1],
                    galleriaIn: [0.55, 0.085, 0.68, 0.53],
                    galleriaOut: [0.25, 0.46, 0.45, 0.94],
                    ease: [0.25, 0, 0.25, 1],
                    linear: [0.25, 0.25, 0.75, 0.75],
                    "ease-in": [0.42, 0, 1, 1],
                    "ease-out": [0, 0, 0.58, 1],
                    "ease-in-out": [0.42, 0, 0.58, 1]
                },
                j = function(a, c, i) {
                    var e = {},
                    i = i || "transition";
                    d.each("webkit moz ms o".split(" "),
                    function() {
                        e["-" + this + "-" + i] = c
                    });
                    a.css(e)
                },
                s = function(a) {
                    j(a, "none", "transition");
                    Galleria.WEBKIT && Galleria.TOUCH && (j(a, "translate3d(0,0,0)", "transform"), a.data("revert") && (a.css(a.data("revert")), a.data("revert", null)))
                },
                u,
                n,
                o,
                q,
                p,
                r,
                N;
                return function(l, K, A) {
                    A = d.extend({
                        duration: 400,
                        complete: D,
                        stop: !1
                    },
                    A);
                    l = d(l);
                    A.duration ? a ? (A.stop && (l.unbind(c), s(l)), u = !1, d.each(K,
                    function(a, c) {
                        N = l.css(a);
                        k.parseValue(N) != k.parseValue(c) && (u = !0);
                        l.css(a, N)
                    }), u ? (n = [], o = A.easing in i ? i[A.easing] : i._default, q = " " + A.duration + "ms cubic-bezier(" + o.join(",") + ")", e.setTimeout(function(a, c, i, e) {
                        return function() {
                            a.one(c,
                            function(a) {
                                return function() {
                                    s(a);
                                    A.complete.call(a[0])
                                }
                            } (a));
                            if (Galleria.WEBKIT && Galleria.TOUCH && (p = {},
                            r = [0, 0, 0], d.each(["left", "top"],
                            function(c, d) {
                                d in i && (r[c] = k.parseValue(i[d]) - k.parseValue(a.css(d)) + "px", p[d] = i[d], delete i[d])
                            }), r[0] || r[1])) a.data("revert", p),
                            n.push("-webkit-transform" + e),
                            j(a, "translate3d(" + r.join(",") + ")", "transform");
                            d.each(i,
                            function(a) {
                                n.push(a + e)
                            });
                            j(a, n.join(","));
                            a.css(i)
                        }
                    } (l, c, K, q), 2)) : e.setTimeout(function() {
                        A.complete.call(l[0])
                    },
                    A.duration)) : l.animate(K, A) : (l.css(K), A.complete.call(l[0]))
                }
            } (),
            removeAlpha: function(a) {
                if (y < 9 && a) {
                    var c = a.style,
                    a = (a = a.currentStyle) && a.filter || c.filter || "";
                    if (/alpha/.test(a)) c.filter = a.replace(/alpha\([^)]*\)/i, "")
                }
            },
            forceStyles: function(a, c) {
                a = d(a);
                a.attr("style") && a.data("styles", a.attr("style")).removeAttr("style");
                a.css(c)
            },
            revertStyles: function() {
                d.each(k.array(arguments),
                function(a, c) {
                    c = d(c);
                    c.removeAttr("style");
                    c.attr("style", "");
                    c.data("styles") && c.attr("style", c.data("styles")).data("styles", null)
                })
            },
            moveOut: function(a) {
                k.forceStyles(a, {
                    position: "absolute",
                    left: -1E4
                })
            },
            moveIn: function() {
                k.revertStyles.apply(k, k.array(arguments))
            },
            elem: function(a) {
                return a instanceof d ? {
                    $: a,
                    dom: a[0]
                }: {
                    $: d(a),
                    dom: a
                }
            },
            hide: function(a, c, d) {
                var d = d || D,
                e = k.elem(a),
                s = e.$,
                a = e.dom;
                s.data("opacity") || s.data("opacity", s.css("opacity"));
                e = {
                    opacity: 0
                };
                c ? k.animate(a, e, {
                    duration: c,
                    complete: y < 9 && a ?
                    function() {
                        k.removeAlpha(a);
                        a.style.visibility = "hidden";
                        d.call(a)
                    }: d,
                    stop: !0
                }) : y < 9 && a ? (k.removeAlpha(a), a.style.visibility = "hidden") : s.css(e)
            },
            show: function(a, c, d) {
                var d = d || D,
                e = k.elem(a),
                s = e.$,
                a = e.dom,
                u = {
                    opacity: parseFloat(s.data("opacity")) || 1
                };
                if (c) {
                    if (y < 9) s.css("opacity", 0),
                    a.style.visibility = "visible";
                    k.animate(a, u, {
                        duration: c,
                        complete: y < 9 && a ?
                        function() {
                            u.opacity == 1 && k.removeAlpha(a);
                            d.call(a)
                        }: d,
                        stop: !0
                    })
                } else y < 9 && u.opacity == 1 && a ? (k.removeAlpha(a), a.style.visibility = "visible") : s.css(u)
            },
            optimizeTouch: function() {
                var a, c, i, e, k = {},
                u = function(a) {
                    a.preventDefault();
                    k = d.extend({},
                    a, !0)
                },
                n = function() {
                    this.evt = k
                },
                o = function() {
                    this.handler.call(a, this.evt)
                };
                return function(k) {
                    d(k).bind("touchend",
                    function(p) {
                        a = p.target;
                        for (e = !0; a.parentNode && a != p.currentTarget && e;) c = d(a).data("events"),
                        i = d(a).data("fakes"),
                        c && "click" in c ? (e = !1, p.preventDefault(), d(a).click(u).click(), c.click.pop(), d.each(c.click, n), d(a).data("fakes", c.click), delete c.click) : i && (e = !1, p.preventDefault(), d.each(i, o)),
                        a = a.parentNode
                    })
                }
            } (),
            wait: function(a) {
                var a = d.extend({
                    until: z,
                    success: D,
                    error: function() {
                        Galleria.raise("Could not complete wait function.")
                    },
                    timeout: 3E3
                },
                a),
                c = k.timestamp(),
                i,
                j,
                s = function() {
                    j = k.timestamp();
                    i = j - c;
                    if (a.until(i)) return a.success(),
                    !1;
                    if (typeof a.timeout == "number" && j >= c + a.timeout) return a.error(),
                    !1;
                    e.setTimeout(s, 10)
                };
                e.setTimeout(s, 10)
            },
            toggleQuality: function(a, c) {
                if (! (y !== 7 && y !== 8 || !a || a.nodeName.toUpperCase() != "IMG")) typeof c === "undefined" && (c = a.style.msInterpolationMode === "nearest-neighbor"),
                a.style.msInterpolationMode = c ? "bicubic": "nearest-neighbor"
            },
            insertStyleTag: function(a) {
                var c = l.createElement("style");
                O().head.appendChild(c);
                c.styleSheet ? c.styleSheet.cssText = a: (a = l.createTextNode(a), c.appendChild(a))
            },
            loadScript: function(a, c) {
                var i = !1,
                e = d("<script>").attr({
                    src: a,
                    async: !0
                }).get(0);
                e.onload = e.onreadystatechange = function() {
                    if (!i && (!this.readyState || this.readyState === "loaded" || this.readyState === "complete")) i = !0,
                    e.onload = e.onreadystatechange = null,
                    typeof c === "function" && c.call(this, this)
                };
                O().head.appendChild(e)
            },
            parseValue: function(a) {
                return typeof a === "number" ? a: typeof a === "string" ? (a = a.match(/\-?\d|\./g)) && a.constructor === Array ? a.join("") * 1 : 0 : 0
            },
            timestamp: function() {
                return (new Date).getTime()
            },
            loadCSS: function(a, c, i) {
                var e, s;
                d("link[rel=stylesheet]").each(function() {
                    if (RegExp(a).test(this.href)) return e = this,
                    !1
                });
                typeof c === "function" && (i = c, c = void 0);
                i = i || D;
                if (e) return i.call(e, e),
                e;
                s = l.styleSheets.length;
                if (d("#" + c).length) d("#" + c).attr("href", a),
                s--;
                else if (e = d("<link>").attr({
                    rel: "stylesheet",
                    href: a,
                    id: c
                }).get(0), c = d('link[rel="stylesheet"], style'), c.length ? c.get(0).parentNode.insertBefore(e, c[0]) : O().head.appendChild(e), y && s >= 31) {
                    Galleria.raise("You have reached the browser stylesheet limit (31)", !0);
                    return
                }
                if (typeof i === "function") {
                    var u = d("<s>").attr("id", "galleria-loader").hide().appendTo(O().body);
                    k.wait({
                        until: function() {
                            return u.height() == 1
                        },
                        success: function() {
                            u.remove();
                            i.call(e, e)
                        },
                        error: function() {
                            u.remove();
                            Galleria.raise("Theme CSS could not load after 20 sec. Please download the latest theme at http://galleria.io/customer/", !0)
                        },
                        timeout: 2E4
                    })
                }
                return e
            }
        }
    } (),
    Z = function() {
        var a = function(a, e, j, s) {
            var u = this.getOptions("easing"),
            n = this.getStageWidth(),
            o = {
                left: n * (a.rewind ? -1 : 1)
            },
            l = {
                left: 0
            };
            j ? (o.opacity = 0, l.opacity = 1) : o.opacity = 1;
            d(a.next).css(o);
            k.animate(a.next, l, {
                duration: a.speed,
                complete: function(a) {
                    return function() {
                        e();
                        a.css({
                            left: 0
                        })
                    }
                } (d(a.next).add(a.prev)),
                queue: !1,
                easing: u
            });
            if (s) a.rewind = !a.rewind;
            if (a.prev) {
                o = {
                    left: 0
                };
                l = {
                    left: n * (a.rewind ? 1 : -1)
                };
                if (j) o.opacity = 1,
                l.opacity = 0;
                d(a.prev).css(o);
                k.animate(a.prev, l, {
                    duration: a.speed,
                    queue: !1,
                    easing: u,
                    complete: function() {
                        d(this).css("opacity", 0)
                    }
                })
            }
        };
        return {
            active: !1,
            init: function(a, d, e) {
                Z.effects.hasOwnProperty(a) && Z.effects[a].call(this, d, e)
            },
            effects: {
                fade: function(a, e) {
                    d(a.next).css({
                        opacity: 0,
                        left: 0
                    }).show();
                    k.animate(a.next, {
                        opacity: 1
                    },
                    {
                        duration: a.speed,
                        complete: e
                    });
                    a.prev && (d(a.prev).css("opacity", 1).show(), k.animate(a.prev, {
                        opacity: 0
                    },
                    {
                        duration: a.speed
                    }))
                },
                flash: function(a, e) {
                    d(a.next).css({
                        opacity: 0,
                        left: 0
                    });
                    a.prev ? k.animate(a.prev, {
                        opacity: 0
                    },
                    {
                        duration: a.speed / 2,
                        complete: function() {
                            k.animate(a.next, {
                                opacity: 1
                            },
                            {
                                duration: a.speed,
                                complete: e
                            })
                        }
                    }) : k.animate(a.next, {
                        opacity: 1
                    },
                    {
                        duration: a.speed,
                        complete: e
                    })
                },
                pulse: function(a, e) {
                    a.prev && d(a.prev).hide();
                    d(a.next).css({
                        opacity: 0,
                        left: 0
                    }).show();
                    k.animate(a.next, {
                        opacity: 1
                    },
                    {
                        duration: a.speed,
                        complete: e
                    })
                },
                slide: function() {
                    a.apply(this, k.array(arguments))
                },
                fadeslide: function() {
                    a.apply(this, k.array(arguments).concat([!0]))
                },
                doorslide: function() {
                    a.apply(this, k.array(arguments).concat([!1, !0]))
                }
            }
        }
    } ();
    L.listen();
	
    Galleria = function() {
        var a = this;
        this._options = {};
        this._playing = !1;
        this._playtime = 5E3;
        this._active = null;
        this._queue = {
            length: 0
        };
        this._data = [];
        this._dom = {};
        this._thumbnails = [];
        this._layers = [];
        this._firstrun = this._initialized = !1;
        this._stageHeight = this._stageWidth = 0;
        this._target = void 0;
        this._binds = [];
        this._id = parseInt(Math.random() * 1E4, 10);
        d.each("container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip".split(" "),
        function(c, d) {
            a._dom[d] = k.create("galleria-" + d)
        });
        d.each("current total".split(" "),
        function(c, d) {
            a._dom[d] = k.create("galleria-" + d, "span")
        });
        var c = this._keyboard = {
            keys: {
                UP: 38,
                DOWN: 40,
                LEFT: 37,
                RIGHT: 39,
                RETURN: 13,
                ESCAPE: 27,
                BACKSPACE: 8,
                SPACE: 32
            },
            map: {},
            bound: !1,
            press: function(d) {
                var e = d.keyCode || d.which;
                e in c.map && typeof c.map[e] === "function" && c.map[e].call(a, d)
            },
            attach: function(a) {
                var d, e;
                for (d in a) a.hasOwnProperty(d) && (e = d.toUpperCase(), e in c.keys ? c.map[c.keys[e]] = a[d] : c.map[e] = a[d]);
                if (!c.bound) c.bound = !0,
                E.bind("keydown", c.press)
            },
            detach: function() {
                c.bound = !1;
                c.map = {};
                E.unbind("keydown", c.press)
            }
        },
        i = this._controls = {
            0 : void 0,
            1 : void 0,
            active: 0,
            swap: function() {
                i.active = i.active ? 0 : 1
            },
            getActive: function() {
                return i[i.active]
            },
            getNext: function() {
                return i[1 - i.active]
            }
        },
        j = this._carousel = {
            next: a.$("thumb-nav-right"),
            prev: a.$("thumb-nav-left"),
            width: 0,
            current: 0,
            max: 0,
            hooks: [],
            update: function() {
                var c = 0,
                e = 0,
                i = [0];
                d.each(a._thumbnails,
                function(a, j) {
                    j.ready && (c += j.outerWidth || d(j.container).outerWidth(!0), i[a + 1] = c, e = Math.max(e, j.outerHeight || d(j.container).outerHeight(!0)))
                });
                a.$("thumbnails").css({
                    width: c,
                    height: e
                });
                j.max = c;
                j.hooks = i;
                j.width = a.$("thumbnails-list").width();
                j.setClasses();
                a.$("thumbnails-container").toggleClass("galleria-carousel", c > j.width);
                j.width = a.$("thumbnails-list").width()
            },
            bindControls: function() {
                var c;
                j.next.bind("click",
                function(d) {
                    d.preventDefault();
                    if (a._options.carouselSteps === "auto") for (c = j.current; c < j.hooks.length; c++) {
                        if (j.hooks[c] - j.hooks[j.current] > j.width) {
                            j.set(c - 2);
                            break
                        }
                    } else j.set(j.current + a._options.carouselSteps)
                });
                j.prev.bind("click",
                function(d) {
                    d.preventDefault();
                    if (a._options.carouselSteps === "auto") for (c = j.current; c >= 0; c--) if (j.hooks[j.current] - j.hooks[c] > j.width) {
                        j.set(c + 2);
                        break
                    } else {
                        if (c === 0) {
                            j.set(0);
                            break
                        }
                    } else j.set(j.current - a._options.carouselSteps)
                })
            },
            set: function(a) {
                for (a = Math.max(a, 0); j.hooks[a - 1] + j.width >= j.max && a >= 0;) a--;
                j.current = a;
                j.animate()
            },
            getLast: function(a) {
                return (a || j.current) - 1
            },
            follow: function(a) {
                if (a === 0 || a === j.hooks.length - 2) j.set(a);
                else {
                    for (var c = j.current; j.hooks[c] - j.hooks[j.current] < j.width && c <= j.hooks.length;) c++;
                    a - 1 < j.current ? j.set(a - 1) : a + 2 > c && j.set(a - c + j.current + 2)
                }
            },
            setClasses: function() {
                j.prev.toggleClass("disabled", !j.current);
                j.next.toggleClass("disabled", j.hooks[j.current] + j.width >= j.max)
            },
            animate: function() {
                j.setClasses();
                var c = j.hooks[j.current] * -1;
                isNaN(c) || k.animate(a.get("thumbnails"), {
                    left: c
                },
                {
                    duration: a._options.carouselSpeed,
                    easing: a._options.easing,
                    queue: !1
                })
            }
        },
        s = this._tooltip = {
            initialized: !1,
            open: !1,
            timer: "tooltip" + a._id,
            swapTimer: "swap" + a._id,
            init: function() {
                s.initialized = !0;
                k.insertStyleTag(".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3;opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}");
                a.$("tooltip").css({
                    opacity: 0.8,
                    visibility: "visible",
                    display: "none"
                })
            },
            move: function(c) {
                var d = a.getMousePosition(c).x,
                c = a.getMousePosition(c).y,
                e = a.$("tooltip"),
                i = c,
                j = e.outerHeight(!0) + 1,
                k = e.outerWidth(!0),
                n = j + 15,
                k = a.$("container").width() - k - 2,
                j = a.$("container").height() - j - 2; ! isNaN(d) && !isNaN(i) && (d += 10, i -= 30, d = Math.max(0, Math.min(k, d)), i = Math.max(0, Math.min(j, i)), c < n && (i = n), e.css({
                    left: d,
                    top: i
                }))
            },
            bind: function(c, e) {
                if (!Galleria.TOUCH) {
                    s.initialized || s.init();
                    var i = function() {
                        a.$("container").unbind("mousemove", s.move);
                        a.clearTimer(s.timer);
                        a.$("tooltip").stop().animate({
                            opacity: 0
                        },
                        200,
                        function() {
                            a.$("tooltip").hide();
                            a.addTimer(s.swapTimer,
                            function() {
                                s.open = !1
                            },
                            1E3)
                        })
                    },
                    j = function(c, e) {
                        s.define(c, e);
                        d(c).hover(function() {
                            a.clearTimer(s.swapTimer);
                            a.$("container").unbind("mousemove", s.move).bind("mousemove", s.move).trigger("mousemove");
                            s.show(c);
                            a.addTimer(s.timer,
                            function() {
                                a.$("tooltip").stop().show().animate({
                                    opacity: 1
                                });
                                s.open = !0
                            },
                            s.open ? 0 : 500)
                        },
                        i).click(i)
                    };
                    typeof e === "string" ? j(c in a._dom ? a.get(c) : c, e) : d.each(c,
                    function(c, d) {
                        j(a.get(c), d)
                    })
                }
            },
            show: function(c) {
                var c = d(c in a._dom ? a.get(c) : c),
                i = c.data("tt"),
                j = function(a) {
                    e.setTimeout(function(a) {
                        return function() {
                            s.move(a)
                        }
                    } (a), 10);
                    c.unbind("mouseup", j)
                };
                if (i = typeof i === "function" ? i() : i) a.$("tooltip").html(i.replace(/\s/, "&nbsp;")),
                c.bind("mouseup", j)
            },
            define: function(c, e) {
                if (typeof e !== "function") var i = e,
                e = function() {
                    return i
                };
                c = d(c in a._dom ? a.get(c) : c).data("tt", e);
                s.show(c)
            }
        },
        u = this._fullscreen = {
            scrolled: 0,
            crop: void 0,
            transition: void 0,
            active: !1,
            keymap: a._keyboard.map,
            parseCallback: function(c, e) {
                return Z.active ?
                function() {
                    typeof c == "function" && c();
                    var i = a._controls.getActive(),
                    j = a._controls.getNext();
                    a._scaleImage(j);
                    a._scaleImage(i);
                    e && a._options.trueFullscreen && d(i.container).add(j.container).trigger("transitionend")
                }: c
            },
            enter: function(c) {
                c = u.parseCallback(c, !0);
                a._options.trueFullscreen && L.support ? L.enter(a, c) : u._enter(c)
            },
            _enter: function(c) {
                u.active = !0;
                k.hide(a.getActiveImage());
                a.$("container").addClass("fullscreen");
                u.scrolled = t.scrollTop();
                k.forceStyles(a.get("container"), {
                    position: "fixed",
                    top: 0,
                    left: 0,
                    width: "100%",
                    height: "100%",
                    zIndex: 1E4
                });
                var e = {
                    height: "100%",
                    overflow: "hidden",
                    margin: 0,
                    padding: 0
                },
                i = a.getData(),
                j = a._options;
                k.forceStyles(O().html, e);
                k.forceStyles(O().body, e);
                u.keymap = d.extend({},
                a._keyboard.map);
                a.attachKeyboard({
                    escape: a.exitFullscreen,
                    right: a.next,
                    left: a.prev
                });
                u.crop = j.imageCrop;
                if (j.fullscreenCrop != void 0) j.imageCrop = j.fullscreenCrop;
                if (i && i.big && i.image !== i.big) {
                    var e = new Galleria.Picture,
                    n = e.isCached(i.big),
                    s = a.getIndex(),
                    o = a._thumbnails[s];
                    a.trigger({
                        type: Galleria.LOADSTART,
                        cached: n,
                        rewind: !1,
                        index: s,
                        imageTarget: a.getActiveImage(),
                        thumbTarget: o,
                        galleriaData: i
                    });
                    e.load(i.big,
                    function(c) {
                        a._scaleImage(c, {
                            complete: function(c) {
                                a.trigger({
                                    type: Galleria.LOADFINISH,
                                    cached: n,
                                    index: s,
                                    rewind: !1,
                                    imageTarget: c.image,
                                    thumbTarget: o
                                });
                                var e = a._controls.getActive().image;
                                e && d(e).width(c.image.width).height(c.image.height).attr("style", d(c.image).attr("style")).attr("src", c.image.src)
                            }
                        })
                    })
                }
                a.rescale(function() {
                    a.addTimer(!1,
                    function() {
                        k.show(a.getActiveImage());
                        typeof c === "function" && c.call(a)
                    },
                    100);
                    a.trigger(Galleria.FULLSCREEN_ENTER)
                });
                t.resize(function() {
                    u.scale()
                })
            },
            scale: function() {
                a.rescale()
            },
            exit: function(c) {
                c = u.parseCallback(c);
                a._options.trueFullscreen && L.support ? L.exit(c) : u._exit(c)
            },
            _exit: function(c) {
                u.active = !1;
                k.hide(a.getActiveImage());
                a.$("container").removeClass("fullscreen");
                k.revertStyles(a.get("container"), O().html, O().body);
                e.scrollTo(0, u.scrolled);
                a.detachKeyboard();
                a.attachKeyboard(u.keymap);
                a._options.imageCrop = u.crop;
                var d = a.getData().big,
                i = a._controls.getActive().image; ! a.getData().iframe && i && d && d == i.src && e.setTimeout(function(a) {
                    return function() {
                        i.src = a
                    }
                } (a.getData().image), 1);
                a.rescale(function() {
                    a.addTimer(!1,
                    function() {
                        k.show(a.getActiveImage());
                        typeof c === "function" && c.call(a);
                        t.trigger("resize")
                    },
                    50);
                    a.trigger(Galleria.FULLSCREEN_EXIT)
                });
                t.unbind("resize", u.scale)
            }
        },
        n = this._idle = {
            trunk: [],
            bound: !1,
            active: !1,
            add: function(a, c, e, i) {
                if (a) {
                    n.bound || n.addEvent();
                    a = d(a);
                    typeof e == "boolean" && (i = e, e = {});
                    var e = e || {},
                    j = {},
                    k;
                    for (k in c) c.hasOwnProperty(k) && (j[k] = a.css(k));
                    a.data("idle", {
                        from: d.extend(j, e),
                        to: c,
                        complete: !0,
                        busy: !1
                    });
                    i ? a.css(c) : n.addTimer();
                    n.trunk.push(a)
                }
            },
            remove: function(c) {
                c = d(c);
                d.each(n.trunk,
                function(a, d) {
                    d && d.length && !d.not(c).length && (c.css(c.data("idle").from), n.trunk.splice(a, 1))
                });
                n.trunk.length || (n.removeEvent(), a.clearTimer(n.timer))
            },
            addEvent: function() {
                n.bound = !0;
                a.$("container").bind("mousemove click", n.showAll);
                a._options.idleMode == "hover" && a.$("container").bind("mouseleave", n.hide)
            },
            removeEvent: function() {
                n.bound = !1;
                a.$("container").bind("mousemove click", n.showAll);
                a._options.idleMode == "hover" && a.$("container").unbind("mouseleave", n.hide)
            },
            addTimer: function() {
                a._options.idleMode != "hover" && a.addTimer("idle",
                function() {
                    n.hide()
                },
                a._options.idleTime)
            },
            hide: function() {
                if (a._options.idleMode && !(a.getIndex() === !1 || a.getData().iframe)) {
                    a.trigger(Galleria.IDLE_ENTER);
                    var c = n.trunk.length;
                    d.each(n.trunk,
                    function(d, e) {
                        var i = e.data("idle");
                        if (i) e.data("idle").complete = !1,
                        k.animate(e, i.to, {
                            duration: a._options.idleSpeed,
                            complete: function() {
                                if (d == c - 1) n.active = !1
                            }
                        })
                    })
                }
            },
            showAll: function() {
                a.clearTimer("idle");
                d.each(n.trunk,
                function(a, c) {
                    n.show(c)
                })
            },
            show: function(c) {
                var e = c.data("idle");
                if (!n.active || !e.busy && !e.complete) e.busy = !0,
                a.trigger(Galleria.IDLE_EXIT),
                a.clearTimer("idle"),
                k.animate(c, e.from, {
                    duration: a._options.idleSpeed / 2,
                    complete: function() {
                        n.active = !0;
                        d(c).data("idle").busy = !1;
                        d(c).data("idle").complete = !0
                    }
                });
                n.addTimer()
            }
        },
        o = this._lightbox = {
            width: 0,
            height: 0,
            initialized: !1,
            active: null,
            image: null,
            elems: {},
            keymap: !1,
            init: function() {
                a.trigger(Galleria.LIGHTBOX_OPEN);
                if (!o.initialized) {
                    o.initialized = !0;
                    var c = {},
                    e = a._options,
                    i = "",
                    e = {
                        overlay: "position:fixed;display:none;opacity:" + e.overlayOpacity + ";filter:alpha(opacity=" + e.overlayOpacity * 100 + ");top:0;left:0;width:100%;height:100%;background:" + e.overlayBackground + ";z-index:99990",
                        box: "position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",
                        shadow: "position:absolute;background:#000;width:100%;height:100%;",
                        content: "position:absolute;background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",
                        info: "position:absolute;bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",
                        close: "position:absolute;top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",
                        image: "position:absolute;top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",
                        prevholder: "position:absolute;width:50%;top:0;bottom:40px;cursor:pointer;",
                        nextholder: "position:absolute;width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",
                        prev: "position:absolute;top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",
                        next: "position:absolute;top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",
                        title: "float:left",
                        counter: "float:right;margin-left:8px;"
                    },
                    j = {};
                    y && y > 7 && (e.nextholder += "background:#000;filter:alpha(opacity=0);", e.prevholder += "background:#000;filter:alpha(opacity=0);");
                    d.each(e,
                    function(a, c) {
                        i += ".galleria-lightbox-" + a + "{" + c + "}"
                    });
                    i += ".galleria-lightbox-box.iframe .galleria-lightbox-prevholder,.galleria-lightbox-box.iframe .galleria-lightbox-nextholder{width:100px;height:100px;top:50%;margin-top:-70px}";
                    k.insertStyleTag(i);
                    d.each("overlay box content shadow title info close prevholder prev nextholder next counter image".split(" "),
                    function(d, e) {
                        a.addElement("lightbox-" + e);
                        c[e] = o.elems[e] = a.get("lightbox-" + e)
                    });
                    o.image = new Galleria.Picture;
                    d.each({
                        box: "shadow content close prevholder nextholder",
                        info: "title counter",
                        content: "info image",
                        prevholder: "prev",
                        nextholder: "next"
                    },
                    function(a, c) {
                        var e = [];
                        d.each(c.split(" "),
                        function(a, c) {
                            e.push("lightbox-" + c)
                        });
                        j["lightbox-" + a] = e
                    });
                    a.append(j);
                    d(c.image).append(o.image.container);
                    d(O().body).append(c.overlay, c.box);
                    k.optimizeTouch(c.box); (function(a) {
                        return a.hover(function() {
                            d(this).css("color", "#bbb")
                        },
                        function() {
                            d(this).css("color", "#444")
                        })
                    })(d(c.close).bind("click", o.hide).html("&#215;"));
                    d.each(["Prev", "Next"],
                    function(a, e) {
                        var i = d(c[e.toLowerCase()]).html(/v/.test(e) ? "&#8249;&nbsp;": "&nbsp;&#8250;"),
                        j = d(c[e.toLowerCase() + "holder"]);
                        j.bind("click",
                        function() {
                            o["show" + e]()
                        });
                        y < 8 || Galleria.TOUCH ? i.show() : j.hover(function() {
                            i.show()
                        },
                        function() {
                            i.stop().fadeOut(200)
                        })
                    });
                    d(c.overlay).bind("click", o.hide);
                    if (Galleria.IPAD) a._options.lightboxTransitionSpeed = 0
                }
            },
            rescale: function(c) {
                var e = Math.min(t.width() - 40, o.width),
                i = Math.min(t.height() - 60, o.height),
                i = Math.min(e / o.width, i / o.height),
                e = Math.round(o.width * i) + 40,
                i = Math.round(o.height * i) + 60,
                e = {
                    width: e,
                    height: i,
                    "margin-top": Math.ceil(i / 2) * -1,
                    "margin-left": Math.ceil(e / 2) * -1
                };
                c ? d(o.elems.box).css(e) : d(o.elems.box).animate(e, {
                    duration: a._options.lightboxTransitionSpeed,
                    easing: a._options.easing,
                    complete: function() {
                        var c = o.image,
                        e = a._options.lightboxFadeSpeed;
                        a.trigger({
                            type: Galleria.LIGHTBOX_IMAGE,
                            imageTarget: c.image
                        });
                        d(c.container).show();
                        d(c.image).animate({
                            opacity: 1
                        },
                        e);
                        k.show(o.elems.info, e)
                    }
                })
            },
            hide: function() {
                o.image.image = null;
                t.unbind("resize", o.rescale);
                d(o.elems.box).hide();
                k.hide(o.elems.info);
                a.detachKeyboard();
                a.attachKeyboard(o.keymap);
                o.keymap = !1;
                k.hide(o.elems.overlay, 200,
                function() {
                    d(this).hide().css("opacity", a._options.overlayOpacity);
                    a.trigger(Galleria.LIGHTBOX_CLOSE)
                })
            },
            showNext: function() {
                o.show(a.getNext(o.active))
            },
            showPrev: function() {
                o.show(a.getPrev(o.active))
            },
            show: function(c) {
                o.active = c = typeof c === "number" ? c: a.getIndex() || 0;
                o.initialized || o.init();
                if (!o.keymap) o.keymap = d.extend({},
                a._keyboard.map),
                a.attachKeyboard({
                    escape: o.hide,
                    right: o.showNext,
                    left: o.showPrev
                });
                t.unbind("resize", o.rescale);
                var i = a.getData(c),
                j = a.getDataLength(),
                n = a.getNext(c),
                s,
                u,
                l;
                k.hide(o.elems.info);
                try {
                    for (l = a._options.preload; l > 0; l--) u = new Galleria.Picture,
                    s = a.getData(n),
                    u.preload("big" in s ? s.big: s.image),
                    n = a.getNext(n)
                } catch(q) {}
                o.image.isIframe = !!i.iframe;
                d(o.elems.box).toggleClass("iframe", !!i.iframe);
                o.image.load(i.iframe || i.big || i.image,
                function(a) {
                    o.width = a.isIframe ? d(e).width() : a.original.width;
                    o.height = a.isIframe ? d(e).height() : a.original.height;
                    d(a.image).css({
                        width: a.isIframe ? "100%": "100.1%",
                        height: a.isIframe ? "100%": "100.1%",
                        top: 0,
                        zIndex: 99998,
                        opacity: 0,
                        visibility: "visible"
                    });
                    o.elems.title.innerHTML = i.title || "";
                    o.elems.counter.innerHTML = c + 1 + " / " + j;
                    t.resize(o.rescale);
                    o.rescale()
                });
                d(o.elems.overlay).show().css("visibility", "visible");
                d(o.elems.box).show()
            }
        },
        l = this._timer = {
            trunk: {},
            add: function(a, c, d, i) {
                a = a || (new Date).getTime();
                i = i || !1;
                this.clear(a);
                if (i) var j = c,
                c = function() {
                    j();
                    l.add(a, c, d)
                };
                this.trunk[a] = e.setTimeout(c, d)
            },
            clear: function(a) {
                var c = function(a) {
                    e.clearTimeout(this.trunk[a]);
                    delete this.trunk[a]
                },
                d;
                if (a && a in this.trunk) c.call(this, a);
                else if (typeof a === "undefined") for (d in this.trunk) this.trunk.hasOwnProperty(d) && c.call(this, d)
            }
        };
        return this
    };
    Galleria.prototype = {
        constructor: Galleria,
        init: function(a, c) {
            c = M(c);
            this._original = {
                target: a,
                options: c,
                data: null
            };
            this._target = this._dom.target = a.nodeName ? a: d(a).get(0);
            this._original.html = this._target.innerHTML;
            X.push(this);
            if (this._target) {
                this._options = {
                    autoplay: !1,
                    carousel: !0,
                    carouselFollow: !0,
                    carouselSpeed: 400,
                    carouselSteps: "auto",
                    clicknext: !1,
                    dailymotion: {
                        foreground: "%23EEEEEE",
                        highlight: "%235BCEC5",
                        background: "%23222222",
                        logo: 0,
                        hideInfos: 1
                    },
                    dataConfig: function() {
                        return {}
                    },
                    dataSelector: "img",
                    dataSort: !1,
                    dataSource: this._target,
                    debug: void 0,
                    dummy: void 0,
                    easing: "galleria",
                    extend: function() {},
                    fullscreenCrop: void 0,
                    fullscreenDoubleTap: !0,
                    fullscreenTransition: void 0,
                    height: 0,
                    idleMode: !0,
                    idleTime: 3E3,
                    idleSpeed: 200,
                    imageCrop: !1,
                    imageMargin: 0,
                    imagePan: !1,
                    imagePanSmoothness: 12,
                    imagePosition: "50%",
                    imageTimeout: void 0,
                    initialTransition: void 0,
                    keepSource: !1,
                    layerFollow: !0,
                    lightbox: !1,
                    lightboxFadeSpeed: 200,
                    lightboxTransitionSpeed: 200,
                    linkSourceImages: !0,
                    maxScaleRatio: void 0,
                    minScaleRatio: void 0,
                    overlayOpacity: 0.85,
                    overlayBackground: "#0b0b0b",
                    pauseOnInteraction: !0,
                    popupLinks: !1,
                    preload: 2,
                    queue: !0,
                    responsive: !0,
                    show: 0,
                    showInfo: !0,
                    showCounter: !0,
                    showImagenav: !0,
                    swipe: !0,
                    thumbCrop: !0,
                    thumbEventType: "click",
                    thumbFit: !0,
                    thumbMargin: 0,
                    thumbQuality: "auto",
                    thumbDisplayOrder: !0,
                    thumbnails: !0,
                    touchTransition: void 0,
                    transition: "fade",
                    transitionInitial: void 0,
                    transitionSpeed: 400,
                    trueFullscreen: !0,
                    useCanvas: !1,
                    vimeo: {
                        title: 0,
                        byline: 0,
                        portrait: 0,
                        color: "aaaaaa"
                    },
                    wait: 5E3,
                    width: "auto",
                    youtube: {
                        modestbranding: 1,
                        autohide: 1,
                        color: "white",
                        hd: 1,
                        rel: 0,
                        showinfo: 0
                    }
                };
                this._options.initialTransition = this._options.initialTransition || this._options.transitionInitial;
                c && c.debug === !1 && (q = !1);
                if (c && typeof c.dummy === "string") F = c.dummy;
                d(this._target).children().hide();
                typeof Galleria.theme === "object" ? this._init() : la.push(this);
                return this
            } else Galleria.raise("Target not found", !0)
        },
        _init: function() {
            var a = this,
            c = this._options;
            if (this._initialized) return Galleria.raise("Init failed: Gallery instance already initialized."),
            this;
            this._initialized = !0;
            if (!Galleria.theme) return Galleria.raise("Init failed: No theme found.", !0),
            this;
            d.extend(!0, c, Galleria.theme.defaults, this._original.options, Galleria.configure.options); (function(a) {
                "getContext" in a && (R = R || {
                    elem: a,
                    context: a.getContext("2d"),
                    cache: {},
                    length: 0
                })
            })(l.createElement("canvas"));
            this.bind(Galleria.DATA,
            function() {
                Galleria.QUIRK && Galleria.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML.");
                this._original.data = this._data;
                this.get("total").innerHTML = this.getDataLength();
                var c = this.$("container");
                if (a._options.height < 2) a._ratio = a._options.height;
                var d = {
                    width: 0,
                    height: 0
                },
                i = function() {
                    return a.$("stage").height()
                };
                k.wait({
                    until: function() {
                        d = a._getWH();
                        c.width(d.width).height(d.height);
                        return i() && d.width && d.height > 50
                    },
                    success: function() {
                        a._width = d.width;
                        a._height = d.height;
                        a._ratio = a._ratio || d.height / d.width;
                        Galleria.WEBKIT ? e.setTimeout(function() {
                            a._run()
                        },
                        1) : a._run()
                    },
                    error: function() {
                        i() ? Galleria.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:" + d.width + "px, height: " + d.height + "px.", !0) : Galleria.raise("Could not extract a stage height from the CSS. Traced height: " + i() + "px.", !0)
                    },
                    timeout: typeof this._options.wait == "number" ? this._options.wait: !1
                })
            });
            this.append({
                "info-text": ["info-title", "info-description"],
                info: ["info-text"],
                "image-nav": ["image-nav-right", "image-nav-left"],
                stage: ["images", "loader", "counter", "image-nav"],
                "thumbnails-list": ["thumbnails"],
                "thumbnails-container": ["thumb-nav-left", "thumbnails-list", "thumb-nav-right"],
                container: ["stage", "thumbnails-container", "info", "tooltip"]
            });
            k.hide(this.$("counter").append(this.get("current"), l.createTextNode(" / "), this.get("total")));
            this.setCounter("&#8211;");
            k.hide(a.get("tooltip"));
            this.$("container").addClass(Galleria.TOUCH ? "touch": "notouch");
            d.each(Array(2),
            function(c) {
                var e = new Galleria.Picture;
                d(e.container).css({
                    position: "absolute",
                    top: 0,
                    left: 0
                }).prepend(a._layers[c] = d(k.create("galleria-layer")).css({
                    position: "absolute",
                    top: 0,
                    left: 0,
                    right: 0,
                    bottom: 0,
                    zIndex: 2
                })[0]);
                a.$("images").append(e.container);
                a._controls[c] = e
            });
            this.$("images").css({
                position: "relative",
                top: 0,
                left: 0,
                width: "100%",
                height: "100%"
            });
            this.$("thumbnails, thumbnails-list").css({
                overflow: "hidden",
                position: "relative"
            });
            this.$("image-nav-right, image-nav-left").bind("click",
            function(d) {
                c.clicknext && d.stopPropagation();
                c.pauseOnInteraction && a.pause();
                d = /right/.test(this.className) ? "next": "prev";
                a[d]()
            });
            d.each(["info", "counter", "image-nav"],
            function(d, e) {
                c["show" + e.substr(0, 1).toUpperCase() + e.substr(1).replace(/-/, "")] === !1 && k.moveOut(a.get(e.toLowerCase()))
            });
            this.load();
            if (!c.keepSource && !y) this._target.innerHTML = "";
            this.get("errors") && this.appendChild("target", "errors");
            this.appendChild("target", "container");
            if (c.carousel) {
                var i = 0,
                j = c.show;
                this.bind(Galleria.THUMBNAIL,
                function() {
                    this.updateCarousel(); ++i == this.getDataLength() && typeof j == "number" && j > 0 && this._carousel.follow(j)
                })
            }
            c.responsive && t.bind("resize",
            function() {
                a.isFullscreen() || a.resize()
            });
            c.swipe && (function(c) {
                var d = [0, 0],
                e = [0, 0],
                i = !1,
                j = 0,
                p,
                l = {
                    start: "touchstart",
                    move: "touchmove",
                    stop: "touchend"
                },
                q = function(a) {
                    a.originalEvent.touches && a.originalEvent.touches.length > 1 || (p = a.originalEvent.touches ? a.originalEvent.touches[0] : a, e = [p.pageX, p.pageY], d[0] || (d = e), Math.abs(d[0] - e[0]) > 10 && a.preventDefault())
                },
                x = function(p) {
                    c.unbind(l.move, q);
                    p.originalEvent.touches && p.originalEvent.touches.length || i ? i = !i: (k.timestamp() - j < 1E3 && Math.abs(d[0] - e[0]) > 30 && Math.abs(d[1] - e[1]) < 100 && (p.preventDefault(), a[d[0] > e[0] ? "next": "prev"]()), d = e = [0, 0])
                };
                c.bind(l.start,
                function(a) {
                    a.originalEvent.touches && a.originalEvent.touches.length > 1 || (p = a.originalEvent.touches ? a.originalEvent.touches[0] : a, j = k.timestamp(), d = e = [p.pageX, p.pageY], c.bind(l.move, q).one(l.stop, x))
                })
            } (a.$("images")), c.fullscreenDoubleTap && this.$("stage").bind("touchstart",
            function() {
                var c, d, e, i, j, k;
                return function(l) {
                    k = Galleria.utils.timestamp();
                    d = (l.originalEvent.touches ? l.originalEvent.touches[0] : l).pageX;
                    e = (l.originalEvent.touches ? l.originalEvent.touches[0] : l).pageY;
                    k - c < 500 && d - i < 20 && e - j < 20 ? (a.toggleFullscreen(), l.preventDefault(), a.$("stage").unbind("touchend", arguments.callee)) : (c = k, i = d, j = e)
                }
            } ()));
            k.optimizeTouch(this.get("container"));
            d.each(Galleria.on.binds,
            function(c, e) {
                d.inArray(e.hash, a._binds) == -1 && a.bind(e.type, e.callback)
            });
            return this
        },
        addTimer: function() {
            this._timer.add.apply(this._timer, k.array(arguments));
            return this
        },
        clearTimer: function() {
            this._timer.clear.apply(this._timer, k.array(arguments));
            return this
        },
        _getWH: function() {
            var a = this.$("container"),
            c = this.$("target"),
            e = this,
            j = {},
            s;
            d.each(["width", "height"],
            function(d, n) {
                e._options[n] && typeof e._options[n] === "number" ? j[n] = e._options[n] : (s = [k.parseValue(a.css(n)), k.parseValue(c.css(n)), a[n](), c[n]()], e["_" + n] || s.splice(s.length, k.parseValue(a.css("min-" + n)), k.parseValue(c.css("min-" + n))), j[n] = Math.max.apply(Math, s))
            });
            if (e._ratio) j.height = j.width * e._ratio;
            return j
        },
        _createThumbnails: function(a) {
            this.get("total").innerHTML = this.getDataLength();
            var c, i, j, s, u = this,
            n = this._options,
            o = a ? this._data.length - a.length: 0,
            q = o,
            p = [],
            r = 0,
            x = y < 8 ? "http://upload.wikimedia.org/wikipedia/commons/c/c0/Blank.gif": "data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",
            v = function() {
                var a = u.$("thumbnails").find(".active");
                if (!a.length) return ! 1;
                return a.find("img").attr("src")
            } (),
            z = typeof n.thumbnails === "string" ? n.thumbnails.toLowerCase() : null,
            A = function(a) {
                return l.defaultView && l.defaultView.getComputedStyle ? l.defaultView.getComputedStyle(c.container, null)[a] : s.css(a)
            },
            t = function(a, c, e) {
                return function() {
                    d(e).append(a);
                    u.trigger({
                        type: Galleria.THUMBNAIL,
                        thumbTarget: a,
                        index: c,
                        galleriaData: u.getData(c)
                    })
                }
            },
            C = function(a) {
                n.pauseOnInteraction && u.pause();
                var c = d(a.currentTarget).data("index");
                u.getIndex() !== c && u.show(c);
                a.preventDefault()
            },
            F = function(a, c) {
                d(a.container).css("visibility", "visible");
                u.trigger({
                    type: Galleria.THUMBNAIL,
                    thumbTarget: a.image,
                    index: a.data.order,
                    galleriaData: u.getData(a.data.order)
                });
                typeof c == "function" && c.call(u, a)
            },
            I = function(a, c) {
                a.scale({
                    width: a.data.width,
                    height: a.data.height,
                    crop: n.thumbCrop,
                    margin: n.thumbMargin,
                    canvas: n.useCanvas,
                    complete: function(a) {
                        var e = ["left", "top"],
                        i,
                        j,
                        o = u.getData(a.index),
                        s = o.thumb.split(":");
                        d.each(["Width", "Height"],
                        function(c, k) {
                            i = k.toLowerCase();
                            if ((n.thumbCrop !== !0 || n.thumbCrop === i) && n.thumbFit) j = {},
                            j[i] = a[i],
                            d(a.container).css(j),
                            j = {},
                            j[e[c]] = 0,
                            d(a.image).css(j);
                            a["outer" + k] = d(a.container)["outer" + k](!0)
                        });
                        k.toggleQuality(a.image, n.thumbQuality === !0 || n.thumbQuality === "auto" && a.original.width < a.width * 3);
                        o.iframe && s.length == 2 && s[0] in P ? P[s[0]].getThumb(s[1],
                        function(d) {
                            return function(e) {
                                d.src = e;
                                F(a, c)
                            }
                        } (a.image)) : n.thumbDisplayOrder && !a.lazy ? d.each(p,
                        function(a, d) {
                            if (a === r && d.ready && !d.displayed) r++,
                            d.displayed = !0,
                            F(d, c)
                        }) : F(a, c)
                    }
                })
            };
            if (!a) this._thumbnails = [],
            this.$("thumbnails").empty();
            for (; this._data[o]; o++) i = this._data[o],
            a = i.thumb || i.image,
            (n.thumbnails === !0 || z == "lazy") && (i.thumb || i.image) ? (c = new Galleria.Picture(o), c.index = o, c.displayed = !1, c.lazy = !1, c.video = !1, this.$("thumbnails").append(c.container), s = d(c.container), s.css("visibility", "hidden"), c.data = {
                width: k.parseValue(A("width")),
                height: k.parseValue(A("height")),
                order: o,
                src: a
            },
            n.thumbFit && n.thumbCrop !== !0 ? s.css({
                width: "auto",
                height: "auto"
            }) : s.css({
                width: c.data.width,
                height: c.data.height
            }), j = a.split(":"), j.length == 2 && j[0] in P ? (c.video = !0, c.ready = !0, c.load(x, {
                height: c.data.height,
                width: c.data.height * 1.25
            },
            I)) : z == "lazy" ? (s.addClass("lazy"), c.lazy = !0, c.load(x, {
                height: c.data.height,
                width: c.data.width
            })) : c.load(a, I), n.preload === "all" && c.preload(i.image)) : i.iframe || z === "empty" || z === "numbers" ? (c = {
                container: k.create("galleria-image"),
                image: k.create("img", "span"),
                ready: !0
            },
            z === "numbers" && d(c.image).text(o + 1), i.iframe && d(c.image).addClass("iframe"), this.$("thumbnails").append(c.container), e.setTimeout(t(c.image, o, c.container), 50 + o * 20)) : c = {
                container: null,
                image: null
            },
            d(c.container).add(n.keepSource && n.linkSourceImages ? i.original: null).data("index", o).bind(n.thumbEventType, C).data("thumbload", I),
            v === a && d(c.container).addClass("active"),
            this._thumbnails.push(c);
            p = this._thumbnails.slice(q);
            return this
        },
        lazyLoad: function(a, c) {
            var e = a.constructor == Array ? a: [a],
            j = this;
            this.$("thumbnails").children().filter(function() {
                return d(this).data("lazy-src")
            });
            var k = 0;
            d.each(e,
            function(a, n) {
                if (! (n > j._thumbnails.length - 1)) {
                    var o = j._thumbnails[n],
                    l = o.data;
                    l.src.split(":");
                    var p = function() {++k == e.length && typeof c == "function" && c.call(j)
                    },
                    r = d(o.container).data("thumbload");
                    o.video ? r.call(j, o, p) : o.load(l.src,
                    function(a) {
                        r.call(j, a, p)
                    })
                }
            });
            return this
        },
        lazyLoadChunks: function(a, c) {
            for (var d = this.getDataLength(), j = 0, k = 0, l = [], n = [], o = this, c = c || 0; j < d; j++) if (n.push(j), ++k == a || j == d - 1) l.push(n),
            k = 0,
            n = [];
            var q = function(a) {
                var d = l.shift();
                d && e.setTimeout(function() {
                    o.lazyLoad(d,
                    function() {
                        q(!0)
                    })
                },
                c && a ? c: 0)
            };
            q(!1);
            return this
        },
        _run: function() {
            var a = this;
            a._createThumbnails();
            k.wait({
                timeout: 1E4,
                until: function() {
                    Galleria.OPERA && a.$("stage").css("display", "inline-block");
                    a._stageWidth = a.$("stage").width();
                    a._stageHeight = a.$("stage").height();
                    return a._stageWidth && a._stageHeight > 50
                },
                success: function() {
                    W.push(a);
                    k.show(a.get("counter"));
                    a._options.carousel && a._carousel.bindControls();
                    if (a._options.autoplay) {
                        a.pause();
                        if (typeof a._options.autoplay === "number") a._playtime = a._options.autoplay;
                        a._playing = !0
                    }
                    a._firstrun ? (a._options.autoplay && a.trigger(Galleria.PLAY), typeof a._options.show === "number" && a.show(a._options.show)) : (a._firstrun = !0, Galleria.History && Galleria.History.change(function(c) {
                        isNaN(c) ? e.history.go( - 1) : a.show(c, void 0, !0)
                    }), a.trigger(Galleria.READY), Galleria.theme.init.call(a, a._options), d.each(Galleria.ready.callbacks,
                    function(c, d) {
                        typeof d == "function" && d.call(a, a._options)
                    }), a._options.extend.call(a, a._options), /^[0-9]{1,4}$/.test(C) && Galleria.History ? a.show(C, void 0, !0) : a._data[a._options.show] && a.show(a._options.show), a._options.autoplay && a.trigger(Galleria.PLAY))
                },
                error: function() {
                    Galleria.raise("Stage width or height is too small to show the gallery. Traced measures: width:" + a._stageWidth + "px, height: " + a._stageHeight + "px.", !0)
                }
            })
        },
        load: function(a, c, e) {
            var j = this,
            k = this._options;
            this._data = [];
            this._thumbnails = [];
            this.$("thumbnails").empty();
            typeof c === "function" && (e = c, c = null);
            a = a || k.dataSource;
            c = c || k.dataSelector;
            e = e || k.dataConfig;
            /^function Object/.test(a.constructor) && (a = [a]);
            a.constructor === Array ? this.validate(a) ? this._data = a: Galleria.raise("Load failed: JSON Array not valid.") : (c += ",.video,.iframe", d(a).find(c).each(function(a, c) {
                var c = d(c),
                k = {},
                s = c.parent(),
                l = s.attr("href"),
                s = s.attr("rel");
                l && (c[0].nodeName == "IMG" || c.hasClass("video")) && Q(l) ? k.video = l: l && c.hasClass("iframe") ? k.iframe = l: k.image = k.big = l;
                if (s) k.big = s;
                d.each("big title description link layer".split(" "),
                function(a, d) {
                    c.data(d) && (k[d] = c.data(d))
                });
                j._data.push(d.extend({
                    title: c.attr("title") || "",
                    thumb: c.attr("src"),
                    image: c.attr("src"),
                    big: c.attr("src"),
                    description: c.attr("alt") || "",
                    link: c.attr("longdesc"),
                    original: c.get(0)
                },
                k, e(c)))
            }));
            typeof k.dataSort == "function" ? v.sort.call(this._data, k.dataSort) : k.dataSort == "random" && this._data.sort(function() {
                return Math.round(Math.random()) - 0.5
            });
            this.getDataLength() && this._parseData().trigger(Galleria.DATA);
            return this
        },
        _parseData: function() {
            var a = this,
            c;
            d.each(this._data,
            function(e, j) {
                c = a._data[e];
                if ("thumb" in j === !1) c.thumb = j.image;
                if (!1 in j) c.big = j.image;
                if ("video" in j) {
                    var k = Q(j.video);
                    if (k && (c.iframe = P[k.provider].embed(k.id) +
                    function() {
                        if (typeof a._options[k.provider] == "object") {
                            var c = [];
                            d.each(a._options[k.provider],
                            function(a, d) {
                                c.push(a + "=" + d)
                            });
                            k.provider == "youtube" && (c = ["wmode=opaque"].concat(c));
                            return "?" + c.join("&")
                        }
                        return ""
                    } (), delete c.video, !("thumb" in c) || !c.thumb)) c.thumb = k.provider + ":" + k.id
                }
            });
            return this
        },
        destroy: function() {
            this.get("target").innerHTML = this._original.html;
            this.clearTimer();
            return this
        },
        splice: function() {
            var a = this,
            c = k.array(arguments);
            e.setTimeout(function() {
                v.splice.apply(a._data, c);
                a._parseData()._createThumbnails()
            },
            2);
            return a
        },
        push: function() {
            var a = this,
            c = k.array(arguments);
            c.length == 1 && c[0].constructor == Array && (c = c[0]);
            e.setTimeout(function() {
                v.push.apply(a._data, c);
                a._parseData()._createThumbnails(c)
            },
            2);
            return a
        },
        _getActive: function() {
            return this._controls.getActive()
        },
        validate: function() {
            return ! 0
        },
        bind: function(a, c) {
            a = U(a);
            this.$("container").bind(a, this.proxy(c));
            return this
        },
        unbind: function(a) {
            a = U(a);
            this.$("container").unbind(a);
            return this
        },
        trigger: function(a) {
            a = typeof a === "object" ? d.extend(a, {
                scope: this
            }) : {
                type: U(a),
                scope: this
            };
            this.$("container").trigger(a);
            return this
        },
        addIdleState: function() {
            this._idle.add.apply(this._idle, k.array(arguments));
            return this
        },
        removeIdleState: function() {
            this._idle.remove.apply(this._idle, k.array(arguments));
            return this
        },
        enterIdleMode: function() {
            this._idle.hide();
            return this
        },
        exitIdleMode: function() {
            this._idle.showAll();
            return this
        },
        enterFullscreen: function() {
            this._fullscreen.enter.apply(this, k.array(arguments));
            return this
        },
        exitFullscreen: function() {
            this._fullscreen.exit.apply(this, k.array(arguments));
            return this
        },
        toggleFullscreen: function() {
            this._fullscreen[this.isFullscreen() ? "exit": "enter"].apply(this, k.array(arguments));
            return this
        },
        bindTooltip: function() {
            this._tooltip.bind.apply(this._tooltip, k.array(arguments));
            return this
        },
        defineTooltip: function() {
            this._tooltip.define.apply(this._tooltip, k.array(arguments));
            return this
        },
        refreshTooltip: function() {
            this._tooltip.show.apply(this._tooltip, k.array(arguments));
            return this
        },
        openLightbox: function() {
            this._lightbox.show.apply(this._lightbox, k.array(arguments));
            return this
        },
        closeLightbox: function() {
            this._lightbox.hide.apply(this._lightbox, k.array(arguments));
            return this
        },
        getActiveImage: function() {
            return this._getActive().image || void 0
        },
        getActiveThumb: function() {
            return this._thumbnails[this._active].image || void 0
        },
        getMousePosition: function(a) {
            return {
                x: a.pageX - this.$("container").offset().left,
                y: a.pageY - this.$("container").offset().top
            }
        },
        addPan: function(a) {
            if (this._options.imageCrop !== !1) {
                var a = d(a || this.getActiveImage()),
                c = this,
                e = a.width() / 2,
                j = a.height() / 2,
                s = parseInt(a.css("left"), 10),
                l = parseInt(a.css("top"), 10),
                n = s || 0,
                o = l || 0,
                q = 0,
                p = 0,
                r = !1,
                x = k.timestamp(),
                z = 0,
                v = 0,
                A = function(c, d, e) {
                    if (c > 0 && (v = Math.round(Math.max(c * -1, Math.min(0, d))), z !== v)) if (z = v, y === 8) a.parent()["scroll" + e](v * -1);
                    else c = {},
                    c[e.toLowerCase()] = v,
                    a.css(c)
                },
                t = function(a) {
                    if (! (k.timestamp() - x < 50)) r = !0,
                    e = c.getMousePosition(a).x,
                    j = c.getMousePosition(a).y
                };
                y === 8 && (a.parent().scrollTop(o * -1).scrollLeft(n * -1), a.css({
                    top: 0,
                    left: 0
                }));
                this.$("stage").unbind("mousemove", t).bind("mousemove", t);
                this.addTimer("pan" + c._id,
                function() {
                    r && (q = a.width() - c._stageWidth, p = a.height() - c._stageHeight, s = e / c._stageWidth * q * -1, l = j / c._stageHeight * p * -1, n += (s - n) / c._options.imagePanSmoothness, o += (l - o) / c._options.imagePanSmoothness, A(p, o, "Top"), A(q, n, "Left"))
                },
                50, !0);
                return this
            }
        },
        proxy: function(a, c) {
            if (typeof a !== "function") return D;
            c = c || this;
            return function() {
                return a.apply(c, k.array(arguments))
            }
        },
        removePan: function() {
            this.$("stage").unbind("mousemove");
            this.clearTimer("pan" + this._id);
            return this
        },
        addElement: function() {
            var a = this._dom;
            d.each(k.array(arguments),
            function(c, d) {
                a[d] = k.create("galleria-" + d)
            });
            return this
        },
        attachKeyboard: function() {
            this._keyboard.attach.apply(this._keyboard, k.array(arguments));
            return this
        },
        detachKeyboard: function() {
            this._keyboard.detach.apply(this._keyboard, k.array(arguments));
            return this
        },
        appendChild: function(a, c) {
            this.$(a).append(this.get(c) || c);
            return this
        },
        prependChild: function(a, c) {
            this.$(a).prepend(this.get(c) || c);
            return this
        },
        remove: function() {
            this.$(k.array(arguments).join(",")).remove();
            return this
        },
        append: function(a) {
            var c, d;
            for (c in a) if (a.hasOwnProperty(c)) if (a[c].constructor === Array) for (d = 0; a[c][d]; d++) this.appendChild(c, a[c][d]);
            else this.appendChild(c, a[c]);
            return this
        },
        _scaleImage: function(a, c) {
            if (a = a || this._controls.getActive()) {
                var e, j = function(a) {
                    d(a.container).children(":first").css({
                        top: Math.max(0, k.parseValue(a.image.style.top)),
                        left: Math.max(0, k.parseValue(a.image.style.left)),
                        width: k.parseValue(a.image.width),
                        height: k.parseValue(a.image.height)
                    })
                },
                c = d.extend({
                    width: this._stageWidth,
                    height: this._stageHeight,
                    crop: this._options.imageCrop,
                    max: this._options.maxScaleRatio,
                    min: this._options.minScaleRatio,
                    margin: this._options.imageMargin,
                    position: this._options.imagePosition
                },
                c);
                this._options.layerFollow && this._options.imageCrop !== !0 ? typeof c.complete == "function" ? (e = c.complete, c.complete = function() {
                    e.call(a, a);
                    j(a)
                }) : c.complete = j: d(a.container).children(":first").css({
                    top: 0,
                    left: 0
                });
                a.scale(c);
                return this
            }
        },
        updateCarousel: function() {
            this._carousel.update();
            return this
        },
        resize: function(a, c) {
            typeof a == "function" && (c = a, a = void 0);
            var a = d.extend({
                width: 0,
                height: 0
            },
            a),
            e = this,
            j = this.$("container");
            d.each(a,
            function(c, d) {
                d || (j[c]("auto"), a[c] = e._getWH()[c])
            });
            d.each(a,
            function(a, c) {
                j[a](c)
            });
            return this.rescale(c)
        },
        rescale: function(a, c, d) {
            var e = this;
            typeof a === "function" && (d = a, a = void 0); (function() {
                e._stageWidth = a || e.$("stage").width();
                e._stageHeight = c || e.$("stage").height();
                e._scaleImage();
                e._options.carousel && e.updateCarousel();
                e.trigger(Galleria.RESCALE);
                typeof d === "function" && d.call(e)
            }).call(e);
            return this
        },
        refreshImage: function() {
            this._scaleImage();
            this._options.imagePan && this.addPan();
            return this
        },
        show: function(a, c, d) {
            if (! (a === !1 || !this._options.queue && this._queue.stalled)) if (a = Math.max(0, Math.min(parseInt(a, 10), this.getDataLength() - 1)), c = typeof c !== "undefined" ? !!c: a < this.getIndex(), !d && Galleria.History) Galleria.History.set(a.toString());
            else return this._active = a,
            v.push.call(this._queue, {
                index: a,
                rewind: c
            }),
            this._queue.stalled || this._show(),
            this
        },
        _show: function() {
            var a = this,
            c = this._queue[0],
            i = this.getData(c.index);
            if (i) {
                var j = i.iframe || (this.isFullscreen() && "big" in i ? i.big: i.image),
                l = this._controls.getActive(),
                u = this._controls.getNext(),
                n = u.isCached(j),
                o = this._thumbnails[c.index],
                q = function() {
                    d(u.image).trigger("mouseup")
                },
                p = function(c, i, j, n, o) {
                    return function() {
                        Z.active = !1;
                        a._queue.stalled = !1;
                        k.toggleQuality(i.image, a._options.imageQuality);
                        a._layers[a._controls.active].innerHTML = "";
                        d(j.container).css({
                            zIndex: 0,
                            opacity: 0
                        }).show();
                        j.isIframe && d(j.container).find("iframe").remove();
                        a.$("container").toggleClass("iframe", !!c.iframe);
                        d(i.container).css({
                            zIndex: 1,
                            left: 0,
                            top: 0
                        }).show();
                        a._controls.swap();
                        a._options.imagePan && a.addPan(i.image); (c.link || a._options.lightbox || a._options.clicknext) && d(i.image).css({
                            cursor: "pointer"
                        }).bind("mouseup",
                        function() {
                            a._options.clicknext && !Galleria.TOUCH ? (a._options.pauseOnInteraction && a.pause(), a.next()) : c.link ? a._options.popupLinks ? e.open(c.link, "_blank") : e.location.href = c.link: a._options.lightbox && a.openLightbox()
                        });
                        v.shift.call(a._queue);
                        a._queue.length && a._show();
                        a._playCheck();
                        a.trigger({
                            type: Galleria.IMAGE,
                            index: n.index,
                            imageTarget: i.image,
                            thumbTarget: o.image,
                            galleriaData: c
                        })
                    }
                } (i, u, l, c, o);
                this._options.carousel && this._options.carouselFollow && this._carousel.follow(c.index);
                if (this._options.preload) {
                    var r, x, z = this.getNext(),
                    t;
                    try {
                        for (x = this._options.preload; x > 0; x--) r = new Galleria.Picture,
                        t = a.getData(z),
                        r.preload(this.isFullscreen() && "big" in t ? t.big: t.image),
                        z = a.getNext(z)
                    } catch(A) {}
                }
                k.show(u.container);
                u.isIframe = !!i.iframe;
                d(a._thumbnails[c.index].container).addClass("active").siblings(".active").removeClass("active");
                a.trigger({
                    type: Galleria.LOADSTART,
                    cached: n,
                    index: c.index,
                    rewind: c.rewind,
                    imageTarget: u.image,
                    thumbTarget: o.image,
                    galleriaData: i
                });
                u.load(j,
                function(e) {
                    var j = d(a._layers[1 - a._controls.active]).html(i.layer || "").hide();
                    a._scaleImage(e, {
                        complete: function(e) {
                            "image" in l && k.toggleQuality(l.image, !1);
                            k.toggleQuality(e.image, !1);
                            a._queue.stalled = !0;
                            a.removePan();
                            a.setInfo(c.index);
                            a.setCounter(c.index);
                            i.layer && (j.show(), (i.link || a._options.lightbox || a._options.clicknext) && j.css("cursor", "pointer").unbind("mouseup").mouseup(q));
                            a.trigger({
                                type: Galleria.LOADFINISH,
                                cached: n,
                                index: c.index,
                                rewind: c.rewind,
                                imageTarget: e.image,
                                thumbTarget: a._thumbnails[c.index].image,
                                galleriaData: a.getData(c.index)
                            });
                            var o = a._options.transition;
                            d.each({
                                initial: l.image === null,
                                touch: Galleria.TOUCH,
                                fullscreen: a.isFullscreen()
                            },
                            function(c, d) {
                                if (d && a._options[c + "Transition"] !== void 0) return o = a._options[c + "Transition"],
                                !1
                            });
                            o in Z.effects === !1 ? p() : (e = {
                                prev: l.container,
                                next: e.container,
                                rewind: c.rewind,
                                speed: a._options.transitionSpeed || 400
                            },
                            Z.active = !0, Z.init.call(a, o, e, p))
                        }
                    })
                })
            }
        },
        getNext: function(a) {
            a = typeof a === "number" ? a: this.getIndex();
            return a === this.getDataLength() - 1 ? 0 : a + 1
        },
        getPrev: function(a) {
            a = typeof a === "number" ? a: this.getIndex();
            return a === 0 ? this.getDataLength() - 1 : a - 1
        },
        next: function() {
            this.getDataLength() > 1 && this.show(this.getNext(), !1);
            return this
        },
        prev: function() {
            this.getDataLength() > 1 && this.show(this.getPrev(), !0);
            return this
        },
        get: function(a) {
            return a in this._dom ? this._dom[a] : null
        },
        getData: function(a) {
            return a in this._data ? this._data[a] : this._data[this._active]
        },
        getDataLength: function() {
            return this._data.length
        },
        getIndex: function() {
            return typeof this._active === "number" ? this._active: !1
        },
        getStageHeight: function() {
            return this._stageHeight
        },
        getStageWidth: function() {
            return this._stageWidth
        },
        getOptions: function(a) {
            return typeof a === "undefined" ? this._options: this._options[a]
        },
        setOptions: function(a, c) {
            typeof a === "object" ? d.extend(this._options, a) : this._options[a] = c;
            return this
        },
        play: function(a) {
            this._playing = !0;
            this._playtime = a || this._playtime;
            this._playCheck();
            this.trigger(Galleria.PLAY);
            return this
        },
        pause: function() {
            this._playing = !1;
            this.trigger(Galleria.PAUSE);
            return this
        },
        playToggle: function(a) {
            return this._playing ? this.pause() : this.play(a)
        },
        isPlaying: function() {
            return this._playing
        },
        isFullscreen: function() {
            return this._fullscreen.active
        },
        _playCheck: function() {
            var a = this,
            c = 0,
            d = k.timestamp(),
            e = "play" + this._id;
            if (this._playing) {
                this.clearTimer(e);
                var l = function() {
                    c = k.timestamp() - d;
                    c >= a._playtime && a._playing ? (a.clearTimer(e), a.next()) : a._playing && (a.trigger({
                        type: Galleria.PROGRESS,
                        percent: Math.ceil(c / a._playtime * 100),
                        seconds: Math.floor(c / 1E3),
                        milliseconds: c
                    }), a.addTimer(e, l, 20))
                };
                a.addTimer(e, l, 20)
            }
        },
        setPlaytime: function(a) {
            this._playtime = a;
            return this
        },
        setIndex: function(a) {
            this._active = a;
            return this
        },
        setCounter: function(a) {
            typeof a === "number" ? a++:typeof a === "undefined" && (a = this.getIndex() + 1);
            this.get("current").innerHTML = a;
            if (y) {
                var a = this.$("counter"),
                c = a.css("opacity");
                parseInt(c, 10) === 1 ? k.removeAlpha(a[0]) : this.$("counter").css("opacity", c)
            }
            return this
        },
        setInfo: function(a) {
            var c = this,
            e = this.getData(a);
            d.each(["title", "description"],
            function(a, d) {
                var k = c.$("info-" + d);
                e[d] ? k[e[d].length ? "show": "hide"]().html(e[d]) : k.empty().hide()
            });
            return this
        },
        hasInfo: function(a) {
            var c = "title description".split(" "),
            d;
            for (d = 0; c[d]; d++) if (this.getData(a)[c[d]]) return ! 0;
            return ! 1
        },
        jQuery: function(a) {
            var c = this,
            e = [];
            d.each(a.split(","),
            function(a, j) {
                j = d.trim(j);
                c.get(j) && e.push(j)
            });
            var j = d(c.get(e.shift()));
            d.each(e,
            function(a, d) {
                j = j.add(c.get(d))
            });
            return j
        },
        $: function() {
            return this.jQuery.apply(this, k.array(arguments))
        }
    };
    d.each(I,
    function(a, c) {
        var d = /_/.test(c) ? c.replace(/_/g, "") : c;
        Galleria[c.toUpperCase()] = "galleria." + d
    });
    d.extend(Galleria, {
        IE9: y === 9,
        IE8: y === 8,
        IE7: y === 7,
        IE6: y === 6,
        IE: y,
        WEBKIT: /webkit/.test(x),
        CHROME: /chrome/.test(x),
        SAFARI: /safari/.test(x) && !/chrome/.test(x),
        QUIRK: y && l.compatMode && l.compatMode === "BackCompat",
        MAC: /mac/.test(navigator.platform.toLowerCase()),
        OPERA: !!e.opera,
        IPHONE: /iphone/.test(x),
        IPAD: /ipad/.test(x),
        ANDROID: /android/.test(x),
        TOUCH: "ontouchstart" in l
    });
    Galleria.addTheme = function(a) {
        a.name || Galleria.raise("No theme name specified");
        a.defaults = typeof a.defaults !== "object" ? {}: M(a.defaults);
        var c = !1,
        i;
        typeof a.css === "string" ? (d("link").each(function(d, e) {
            i = RegExp(a.css);
            if (i.test(e.href)) return c = !0,
            ha(a),
            !1
        }), c || d("script").each(function(d, l) {
            i = RegExp("galleria\\." + a.name.toLowerCase() + "\\.");
            i.test(l.src) && (c = l.src.replace(/[^\/]*$/, "") + a.css, e.setTimeout(function() {
                k.loadCSS(c, "galleria-theme",
                function() {
                    ha(a)
                })
            },
            1))
        }), c || Galleria.raise("No theme CSS loaded")) : ha(a);
        return a
    };
    Galleria.loadTheme = function(a, c) {
        var i = W.length,
        j = e.setTimeout(function() {
            Galleria.raise("Theme at " + a + " could not load, check theme path.", !0)
        },
        5E3);
        Galleria.theme = void 0;
        k.loadScript(a,
        function() {
            e.clearTimeout(j);
            if (i) {
                var a = [];
                d.each(Galleria.get(),
                function(e, i) {
                    var j = d.extend(i._original.options, {
                        data_source: i._data
                    },
                    c);
                    i.$("container").remove();
                    var k = new Galleria;
                    k._id = i._id;
                    k.init(i._original.target, j);
                    a.push(k)
                });
                W = a
            }
        });
        return Galleria
    };
    Galleria.get = function(a) {
        if (X[a]) return X[a];
        else if (typeof a !== "number") return X;
        else Galleria.raise("Gallery index " + a + " not found")
    };
    Galleria.configure = function(a, c) {
        var e = {};
        typeof a == "string" && c ? (e[a] = c, a = e) : d.extend(e, a);
        Galleria.configure.options = e;
        d.each(Galleria.get(),
        function(a, c) {
            c.setOptions(e)
        });
        return Galleria
    };
    Galleria.configure.options = {};
    Galleria.on = function(a, c) {
        if (a) {
            var c = c || D,
            e = a + c.toString().replace(/\s/g, "") + k.timestamp();
            d.each(Galleria.get(),
            function(d, k) {
                k._binds.push(e);
                k.bind(a, c)
            });
            Galleria.on.binds.push({
                type: a,
                callback: c,
                hash: e
            });
            return Galleria
        }
    };
    Galleria.on.binds = [];
    Galleria.run = function(a, c) {
        d(a || "#galleria").galleria(c);
        return Galleria
    };
    Galleria.addTransition = function(a, c) {
        Z.effects[a] = c;
        return Galleria
    };
    Galleria.utils = k;
    Galleria.log = function() {
        var a = k.array(arguments);
        if ("console" in e && "log" in e.console) try {
            return e.console.log.apply(e.console, a)
        } catch(c) {
            d.each(a,
            function() {
                e.console.log(this)
            })
        } else return e.alert(a.join("<br>"))
    };
    Galleria.ready = function(a) {
        if (typeof a != "function") return Galleria;
        d.each(W,
        function(c, d) {
            a.call(d, d._options)
        });
        Galleria.ready.callbacks.push(a);
        return Galleria
    };
    Galleria.ready.callbacks = [];
    Galleria.raise = function(a, c) {
        var e = c ? "Fatal error": "Error",
        j = {
            color: "#fff",
            position: "absolute",
            top: 0,
            left: 0,
            zIndex: 1E5
        },
        k = function(a) {
            var k = '<div style="padding:4px;margin:0 0 2px;background:#' + (c ? "811": "222") + '";>' + (c ? "<strong>" + e + ": </strong>": "") + a + "</div>";
            d.each(X,
            function() {
                var a = this.$("errors"),
                c = this.$("target");
                a.length || (c.css("position", "relative"), a = this.addElement("errors").appendChild("target", "errors").$("errors").css(j));
                a.append(k)
            });
            X.length || d("<div>").css(d.extend(j, {
                position: "fixed"
            })).append(k).appendTo(O().body)
        };
        if (q) {
            if (k(a), c) throw Error(e + ": " + a);
        } else c && !aa && (aa = !0, c = !1, k("Gallery could not load."))
    };
    Galleria.version = 1.28;
    Galleria.requires = function(a, c) {
        Galleria.version < a && Galleria.raise(c || "You need to upgrade Galleria to version " + a + " to use one or more components.", !0);
        return Galleria
    };
    Galleria.Picture = function(a) {
        this.id = a || null;
        this.image = null;
        this.container = k.create("galleria-image");
        d(this.container).css({
            overflow: "hidden",
            position: "relative"
        });
        this.original = {
            width: 0,
            height: 0
        };
        this.isIframe = this.ready = !1
    };
    Galleria.Picture.prototype = {
        cache: {},
        show: function() {
            k.show(this.image)
        },
        hide: function() {
            k.moveOut(this.image)
        },
        clear: function() {
            this.image = null
        },
        isCached: function(a) {
            return !! this.cache[a]
        },
        preload: function(a) {
            d(new Image).load(function(a, d) {
                return function() {
                    d[a] = a
                }
            } (a, this.cache)).attr("src", a)
        },
        load: function(a, c, i) {
            typeof c == "function" && (i = c, c = null);
            if (this.isIframe) {
                var j = "if" + (new Date).getTime();
                this.image = d("<iframe>", {
                    src: a,
                    frameborder: 0,
                    id: j,
                    allowfullscreen: !0,
                    css: {
                        visibility: "hidden"
                    }
                })[0];
                d(this.container).find("iframe,img").remove();
                this.container.appendChild(this.image);
                d("#" + j).load(function(a, c) {
                    return function() {
                        e.setTimeout(function() {
                            d(a.image).css("visibility", "visible");
                            typeof c == "function" && c.call(a, a)
                        },
                        10)
                    }
                } (this, i));
                return this.container
            }
            this.image = new Image;
            var l = !1,
            q = !1,
            j = d(this.container),
            n = d(this.image),
            o = function(a, i, j) {
                return function() {
                    var k = function() {
                        d(this).unbind("load");
                        a.original = c || {
                            height: this.height,
                            width: this.width
                        };
                        a.container.appendChild(this);
                        a.cache[j] = j;
                        typeof i == "function" && e.setTimeout(function() {
                            i.call(a, a)
                        },
                        1)
                    }; ! this.width || !this.height ? e.setTimeout(function(a) {
                        return function() {
                            a.width && a.height ? k.call(a) : q ? Galleria.raise("Could not extract width/height from image: " + a.src + ". Traced measures: width:" + a.width + "px, height: " + a.height + "px.") : (d(new Image).load(o).attr("src", a.src), q = !0)
                        }
                    } (this), 2) : k.call(this)
                }
            } (this, i, a);
            j.find("iframe,img").remove();
            n.css("display", "block");
            k.hide(this.image);
            d.each("minWidth minHeight maxWidth maxHeight".split(" "),
            function(a, c) {
                n.css(c, /min/.test(c) ? "0": "none")
            });
            n.load(o).error(function() {
                l ? F ? d(this).attr("src", F) : Galleria.raise("Image not found: " + a) : (l = !0, e.setTimeout(function(a, c) {
                    return function() {
                        a.attr("src", c + "?" + k.timestamp())
                    }
                } (d(this), a), 50))
            }).attr("src", a);
            return this.container
        },
        scale: function(a) {
            var c = this,
            a = d.extend({
                width: 0,
                height: 0,
                min: void 0,
                max: void 0,
                margin: 0,
                complete: D,
                position: "center",
                crop: !1,
                canvas: !1
            },
            a);
            if (this.isIframe) {
                d(this.image).width(a.width).height(a.height).removeAttr("width").removeAttr("height");
                d(this.container).width(a.width).height(a.height);
                a.complete.call(c, c);
                try {
                    this.image.contentWindow && d(this.image.contentWindow).trigger("resize")
                } catch(e) {}
                return this.container
            }
            if (!this.image) return this.container;
            var j, l, q = d(c.container),
            n;
            k.wait({
                until: function() {
                    j = a.width || q.width() || k.parseValue(q.css("width"));
                    l = a.height || q.height() || k.parseValue(q.css("height"));
                    return j && l
                },
                success: function() {
                    var e = (j - a.margin * 2) / c.original.width,
                    i = (l - a.margin * 2) / c.original.height,
                    p = Math.min(e, i),
                    r = Math.max(e, i),
                    q = {
                        "true": r,
                        width: e,
                        height: i,
                        "false": p,
                        landscape: c.original.width > c.original.height ? r: p,
                        portrait: c.original.width < c.original.height ? r: p
                    } [a.crop.toString()],
                    e = "";
                    a.max && (q = Math.min(a.max, q));
                    a.min && (q = Math.max(a.min, q));
                    d.each(["width", "height"],
                    function(a, e) {
                        d(c.image)[e](c[e] = c.image[e] = Math.round(c.original[e] * q))
                    });
                    d(c.container).width(j).height(l);
                    if (a.canvas && R) R.elem.width = c.width,
                    R.elem.height = c.height,
                    e = c.image.src + ":" + c.width + "x" + c.height,
                    c.image.src = R.cache[e] ||
                    function(a) {
                        R.context.drawImage(c.image, 0, 0, c.original.width * q, c.original.height * q);
                        try {
                            return n = R.elem.toDataURL(),
                            R.length += n.length,
                            R.cache[a] = n
                        } catch(d) {
                            return c.image.src
                        }
                    } (e);
                    var u = {},
                    x = {},
                    e = function(a, e, i) {
                        var j = 0;
                        /\%/.test(a) ? (a = parseInt(a, 10) / 100, e = c.image[e] || d(c.image)[e](), j = Math.ceil(e * -1 * a + i * a)) : j = k.parseValue(a);
                        return j
                    },
                    z = {
                        top: {
                            top: 0
                        },
                        left: {
                            left: 0
                        },
                        right: {
                            left: "100%"
                        },
                        bottom: {
                            top: "100%"
                        }
                    };
                    d.each(a.position.toLowerCase().split(" "),
                    function(a, c) {
                        c === "center" && (c = "50%");
                        u[a ? "top": "left"] = c
                    });
                    d.each(u,
                    function(a, c) {
                        z.hasOwnProperty(c) && d.extend(x, z[c])
                    });
                    u = u.top ? d.extend(u, x) : x;
                    u = d.extend({
                        top: "50%",
                        left: "50%"
                    },
                    u);
                    d(c.image).css({
                        position: "absolute",
                        top: e(u.top, "height", l),
                        left: e(u.left, "width", j)
                    });
                    c.show();
                    c.ready = !0;
                    a.complete.call(c, c)
                },
                error: function() {
                    Galleria.raise("Could not scale image: " + c.image.src)
                },
                timeout: 1E3
            });
            return this
        }
    };
    d.extend(d.easing, {
        galleria: function(a, c, d, e, k) {
            if ((c /= k / 2) < 1) return e / 2 * c * c * c + d;
            return e / 2 * ((c -= 2) * c * c + 2) + d
        },
        galleriaIn: function(a, c, d, e, k) {
            return e * (c /= k) * c + d
        },
        galleriaOut: function(a, c, d, e, k) {
            return - e * (c /= k) * (c - 2) + d
        }
    });
    d.fn.galleria = function(a) {
        var c = this.selector;
        if (!d(this).length) return d(function() {
            d(c).length ? d(c).galleria(a) : Galleria.utils.wait({
                until: function() {
                    return d(c).length
                },
                success: function() {
                    d(c).galleria(a)
                },
                error: function() {
                    Galleria.raise('Init failed: Galleria could not find the element "' + c + '".')
                },
                timeout: 5E3
            })
        }),
        this;
        return this.each(function() {
            d.data(this, "galleria") || d.data(this, "galleria", (new Galleria).init(this, a))
        })
    }
})(jQuery); (function(d) {
    var e = {
        prototyping: function() {
            d('img[src="#"]').attr("src", "/media/i/placeholder.png").addClass("placeholder").each(function() {
                this.width -= 2;
                this.height -= 2
            });
            d('a[href="#"]').click(function(d) {
                d.preventDefault()
            })
        },
        BROWSER: {
            IE: function() {
                for (var d = 3,
                e = document.createElement("div"); e.innerHTML = "<\!--[if gt IE " + ++d + "]><i></i><![endif]--\>", e.getElementsByTagName("i")[0];);
                return d > 4 ? d: void 0
            } ()
        }
    };
    window.Aino = e;
    window.STATIC_URL = "/static/";
    window.THEMES_URL = STATIC_URL + "themes/"
})(jQuery);
var G_DEMO_IMAGES = [{
    title: "Morning river",
    thumb: STATIC_URL + "i/sample-new/3s.jpg",
    image: STATIC_URL + "i/sample-new/3b.jpg",
    description: "A wonderful serenity has taken possession of my entire soul"
},
{
    title: "Scotland",
    thumb: STATIC_URL + "i/sample-new/1s.jpg",
    image: STATIC_URL + "i/sample-new/1m.jpg",
    big: STATIC_URL + "i/sample-new/1b.jpg",
    description: "I throw myself down among the tall grass by the trickling stream"
},
{
    title: "Antarctic Sunset",
    thumb: STATIC_URL + "i/sample/12_m.jpg",
    image: STATIC_URL + "i/sample/12.jpg",
    description: "An Antarctic Sunset, photo taken by Calee Allen on April 6th, 2008."
},
{
    title: "Works for Video too",
    video: "http://vimeo.com/22439234",
    description: "Integrated API for YouTube, Vimeo and Dailymotion videos"
},
{
    title: "Locomotives Roundhouse",
    thumb: STATIC_URL + "i/sample/01_m.jpg",
    image: STATIC_URL + "i/sample/01.jpg",
    description: "Steam locomotives of the Chicago & North Western Railway."
},
{
    title: "Braunwald Alps",
    thumb: STATIC_URL + "i/sample/11_m.jpg",
    image: STATIC_URL + "i/sample/11.jpg",
    description: "View from Braunwald, Switzerland."
},
{
    title: "Icebergs in the High Arctic",
    thumb: STATIC_URL + "i/sample/02_m.jpg",
    image: STATIC_URL + "i/sample/02.jpg",
    description: "\u201dThe debris loading isn't particularly extensive, but the color is usual.\u201d"
},
{
    title: "Ara\u00f1a",
    thumb: STATIC_URL + "i/sample/03_m.jpg",
    image: STATIC_URL + "i/sample/03.jpg",
    description: "Xysticus cristatus, A Estrada, Galicia, Spain"
},
{
    title: "Museo storia naturale",
    thumb: STATIC_URL + "i/sample/04_m.jpg",
    image: STATIC_URL + "i/sample/04.jpg"
},
{
    title: "Grj\u00f3tagj\u00e1 caves in summer 2009",
    thumb: STATIC_URL + "i/sample/05_m.jpg",
    image: STATIC_URL + "i/sample/05.jpg"
},
{
    title: "Thermes",
    thumb: STATIC_URL + "i/sample/06_m.jpg",
    image: STATIC_URL + "i/sample/06.jpg",
    description: "Xanthi hot-spa springs, Xanthi Prefecture, Greece"
},
{
    title: "Polish Army Ko\u0142obrzeg",
    thumb: STATIC_URL + "i/sample/07_m.jpg",
    image: STATIC_URL + "i/sample/07.jpg",
    description: "A display of the Polish Army. Both the soldier, and the vehicle belong to the 7th Pomeranian Coastal Defence Brigade, a part of the Szczecin-based 12th Mechanized Division \u201dBoles\u0142aw Krzywousty\u201d"
},
{
    title: "Zlatograd Bulgaria",
    thumb: STATIC_URL + "i/sample/08_m.jpg",
    image: STATIC_URL + "i/sample/08.jpg"
},
{
    title: "09-28-2001 in New York City",
    thumb: STATIC_URL + "i/sample/09_m.jpg",
    image: STATIC_URL + "i/sample/09.jpg",
    description: "New York, NY, September 28, 2001 -- Debris on surrounding roofs at the site of the World Trade Center. Photo by Andrea Booher/ FEMA News Photo"
},
{
    thumb: STATIC_URL + "i/sample/10_m.jpg",
    image: STATIC_URL + "i/sample/10.jpg"
}]; 
(function(d, e, l) {
    var E = [],
    t = d.G = {
        init: function(d) {
            this.views._global.call(this);
            for (var e = document.body.className.split(" "), l = 0; l < e.length; l++) e[l] in this.views && this.views[e[l]].call(this);
            typeof d === "number" && t.run(d)
        },
        make: function(d, e) {
            E[d] = e
        },
        run: function(d, q, t) {
            q = q || "#demo";
            t = t ||
            function() {};
            l.theme = E[d];
            l.utils.loadCSS(THEMES_URL + d + "/" + d + ".css", "galleria-theme",
            function() {
                e(q).galleria({
                    responsive: !0,
                    height: 0.5,
                    data_source: G_DEMO_IMAGES,
                    extend: function(d) {
                        t.call(this, d)
                    }
                })
            })
        },
        trackDownload: function(d) {
            e(d).each(function() {
                e(this).click(function() {
                    var d = this.href.split("/");
                    _gaq.push(["_trackEvent", "Stats", "Download", d.length > 1 ? d[d.length - 1] : "unknown"])
                })
            })
        },
        views: {
            _global: function() {
                e(".campaign");
                e(".main a:path").addClass("active");
                e(".secondary .box li:last").addClass("last");
                t.trackDownload("a.dl, a.download");
                e(".messages li").each(function() {
                    var d = this;
                    e("<a>", {
                        text: "'",
                        href: "#",
                        "class": "close symbol",
                        click: function(l) {
                            l.preventDefault();
                            e(d).animate({
                                opacity: 0
                            },
                            300,
                            function() {
                                e(d).animate({
                                    height: 0
                                },
                                200,
                                function() {
                                    e(d).remove()
                                })
                            })
                        }
                    }).appendTo(this);
                    this.className == "info" ? e(this).find("p .symbol").text("/") : e(this).find("p .symbol").text("W")
                });
                e("ul.errorlist li").each(function() {
                    e(this).prepend('<span class="symbol">W</span> ')
                })
            },
            admin: function() {
                e(".menu a:path").addClass("active")
            },
            settings: function() {
                var l = e("form.settings"),
                q = l.find(".verify").hide(),
                t = l.find(".email"),
                x = t.val(),
                C;
                t.focus(function() {
                    C = d.setInterval(function() {
                        t.val() != x && q.is(":hidden") ? q.show() : t.val() == x && q.is(":visible") && q.hide()
                    },
                    50)
                }).blur(function() {
                    d.clearInterval(C)
                })
            },
            login: function() {
                e("form.login").find(".error ul").each(function() {
                    e(this).parent().prev("input").addClass("error");
                    e(this).find(".symbol").remove()
                });
                e("#id_login").blur().focus()
            },
            home: function() {
                t.run(1, "#demo",
                function() {
                    Galleria.TOUCH && this.setOptions("transition", "fadeslide");
                    this.setOptions("responsive", !0)
                })
            },
            tp: function() {
                var d = e("#themes");
                e("#theme-switcher").click(function() {
                    d.toggle()
                }).trigger("click")
            },
            docs: function() {},
            "theme-purchase": function() {
                var l = RegExp("^((AT)?U[0-9]{8}|(BE)?0?[0-9]{9}|(BG)?[0-9]{9,10}|(CY)?[0-9]{8}L|(CZ)?[0-9]{8,10}|(DE)?[0-9]{9}|(DK)?[0-9]{8}|(EE)?[0-9]{9}|(EL|GR)?[0-9]{9}|(ES)?[0-9A-Z][0-9]{7}[0-9A-Z]|(FI)?[0-9]{8}|(FR)?[0-9A-Z]{2}[0-9]{9}|(GB)?([0-9]{9}([0-9]{3})?|[A-Z]{2}[0-9]{3})|(HU)?[0-9]{8}|(IE)?[0-9]S[0-9]{5}L|(IT)?[0-9]{11}|(LT)?([0-9]{9}|[0-9]{12})|(LU)?[0-9]{8}|(LV)?[0-9]{11}|(MT)?[0-9]{8}|(NL)?[0-9]{9}B[0-9]{2}|(PL)?[0-9]{10}|(PT)?[0-9]{9}|(RO)?[0-9]{2,10}|(SI)?[0-9]{8}|(SK)?[0-9]{10})$"),
                q = e("form.info"),
                t = !1,
                x = !1,
                C = !1,
                D = q.find(".vat").each(function() {
                    e(this).find("input").val().length || e(this).css({
                        position: "absolute",
                        left: "-100000px"
                    })
                }),
                z = !1,
                y,
                E,
                I = D.find("input"),
                M = q.find(".email"),
                U = M.parent().next(".err"),
                P = !1,
                Q = function() {
                    q.find("input[name=residence]").each(function() {
                        e(this).attr("checked") && (this.className == "sweden" && (L(), z = !1), this.className == "outside" && (W(), z = !1), this.className == "addvat" && t ? (z = !0, x ? W() : L(), D.css({
                            position: "static",
                            left: "auto"
                        }).find("input").focus()) : (this.className == "addvat" && !t && (L(), z = !0), D.css({
                            position: "absolute",
                            left: "-100000px"
                        })))
                    })
                },
                L = function() {
                    E = parseFloat(y) * 0.25;
                    var d = Math.round((parseFloat(y) + E) * 100) / 100;
                    e(".buy-form input[name=amount]").val(d);
                    e(".total span").html("$" + y + " + $" + E + " VAT = <strong>$" + d + "</strong>")
                },
                W = function() {
                    e(".buy-form input[name=amount]").val(y);
                    e(".total span").html("<strong>$" + y + "</strong>")
                },
                X = function() {},
                aa = !1;
                I.blur(function() {
                    if (I.val().length) {
                        var d = I.val().substr(0, 2),
                        q = I.val().substr(2);
                        I.removeClass("error ok").addClass("loading");
                        aa = !0;
                        e.ajax({
                            url: "http://isvat.appspot.com/" + d + "/" + q + "/?callback=?",
                            dataType: "json",
                            success: function(d) {
                                x = d; ! x && z && L();
                                d && t && W();
                                I.attr("class", d ? "ok": "error");
                                aa = !1;
                                X()
                            },
                            error: function() {
                                l.test(I.val()) ? (x = !0, W(), I.attr("class", "ok")) : (x = !1, L(), I.attr("class", "error"))
                            }
                        })
                    } else I.removeClass("error ok loading"),
                    t && z && (x = !1, L())
                });
                M.blur(function() {
                    M.val().length ? P || (C = !0, M.removeClass("error"), U.html("")) : (C = !1, U.html("This field is required."), M.attr("class", "error"))
                });
                if (M.length && M.val().length || !e(".emailwrap").length) C = !0;
                D.find(".btn a").click(function(d) {
                    d.preventDefault();
                    I.blur()
                });
                q.find("input[name=typ]").change(function() {
                    t = this.className == "business";
                    Q()
                }).each(function() {
                    t = this.className == "business" && this.checked
                });
                q.find("input[name=residence]").change(function() {
                    Q()
                });
                y = parseFloat(e(".buy-form").data("price"));
                e("input[type=image]").each(function() {
                    y = y.toFixed(2);
                    var l = '<div class="total">Total: <span>' + (e(this).closest(".buy-form").hasClass("hasvat") ? "$" + y * 0.8 + " + $" + (y * 0.2).toFixed(2) + " VAT = <strong>$" + y: "<strong>$" + y) + "</strong></span></div>",
                    v = e("<a>", {
                        href: "#",
                        html: "Buy Now",
                        click: function(l) {
                            l.preventDefault();
                            e(this).closest("form");
                            var k = e(this),
                            v = arguments.callee;
                            if (e("div.customer").length) e.post(q.attr("action"), q.serialize(),
                            function(a) {
                                if (a.errors) alert("We are very sorry, but something went wrong with your account, please contact us at info@aino.se and describe your problem.");
                                else {
                                    var c = e('<input type="hidden" name="invoice" value="' + a.invoice + '">');
                                    e(".buy-form form").append(c);
                                    k.after('<p class="loading"><em>Contacting PayPal...</em></p>').parent().addClass("disabled");
                                    e(".buy-form input[name=amount]").val(a.total_price);
                                    e(".buy-form form").submit()
                                }
                            },
                            "json");
                            else if (C) {
                                k.unbind("click").parent().addClass("disabled");
                                var a = function() {
                                    e.post(q.attr("action"), q.serialize(),
                                    function(a) {
                                        if (a.errors) if (k.bind("click", v).parent().removeClass("disabled"), a.errors.email) P = !0,
                                        U.html(a.errors.email[0]),
                                        M.attr("class", "error").focus();
                                        else {
                                            var c = e("<div>").addClass("messages"),
                                            l = e("<ul>").appendTo(c),
                                            q = !1;
                                            e.each(a.errors,
                                            function() {
                                                l.append('<li class="error"><p><span class="symbol">W</span>' + this[0] + "</p></li>");
                                                /VAT/.test(this[0]) && (q = !0)
                                            });
                                            c.insertAfter("header.main");
                                            q && D.css({
                                                position: "static",
                                                left: "auto"
                                            }).find("input").attr("class", "error").focus();
                                            d.scrollTo(0, 0)
                                        } else c = e('<input type="hidden" name="invoice" value="' + a.invoice + '">'),
                                        e(".buy-form form").append(c),
                                        M.removeClass("error"),
                                        U.html(""),
                                        k.after('<p class="loading"><em>Contacting PayPal...</em></p>'),
                                        D.find("input").removeClass("error"),
                                        e(".buy-form input[name=amount]").val(a.total_price),
                                        e(".buy-form form").submit()
                                    },
                                    "json")
                                }; (!z || !t) && D.find("input").val("");
                                if (z && t && !x) {
                                    var c = function() {
                                        d.confirm("Are you sure you don\u2019t have a valid VAT number for your business? Without a valid VAT number, we will have to add 25% VAT on the total price. \n\nPress cancel to add your VAT number or OK to complete the purchase including VAT (total " + e(".total span strong").html() + ").") ? (D.find("input").val(""), a()) : (k.bind("click", v).parent().removeClass("disabled"), D.find("input").focus())
                                    };
                                    aa ? X = function() {
                                        x ? a() : c()
                                    }: c()
                                } else a()
                            } else M.attr("class", "error").focus(),
                            U.html("This field is required.")
                        }
                    });
                    e(this).replaceWith(v);
                    v.before(l);
                    v.wrap('<div class="btn send" />')
                });
                Q()
            }
        }
    };
    d.G = t
})(window, jQuery, Galleria); (function(d) {
    G.make(0, {
        defaults: {
            transition: "fade",
            transitionSpeed: 500,
            imageCrop: !1,
            thumbCrop: "height",
            idleMode: "hover",
            idleSpeed: 500,
            fullscreenTransition: !1,
            _locale: {
                show_captions: "Show captions",
                hide_captions: "Hide captions",
                play: "Play slideshow",
                pause: "Pause slideshow",
                enter_fullscreen: "Enter fullscreen",
                exit_fullscreen: "Exit fullscreen",
                next: "Next image",
                prev: "Previous image",
                showing_image: "Showing image %s of %s"
            },
            _toggleCaption: !0,
            _showCaption: !0,
            _showTooltip: !0
        },
        init: function(e) {
            Galleria.requires(1.28, "This version of Azur theme requires Galleria version 1.2.8 or later");
            this.addElement("bar", "fullscreen", "play", "progress").append({
                stage: "progress",
                container: "bar",
                bar: ["fullscreen", "play", "thumbnails-container"]
            }).prependChild("stage", "info").appendChild("container", "tooltip");
            var l = this,
            E = window.document,
            t = e._locale,
            v = "getContext" in E.createElement("canvas"); (function() {
                if (v) {
                    var e = E.createElement("canvas"),
                    q = e.getContext("2d");
                    e.width = 24;
                    e.height = 24;
                    d(e).css({
                        zIndex: 1E4,
                        position: "absolute",
                        right: 10,
                        top: 10
                    }).appendTo(l.get("container"));
                    l.bind("progress",
                    function(l) {
                        d(e).fadeIn(200);
                        l = l.percent * 3.6;
                        q.strokeStyle = "rgba(255,255,255,.7)";
                        q.lineWidth = 3;
                        q.clearRect(0, 0, 24, 24);
                        q.beginPath();
                        q.arc(12, 12, 10, -90 * (Math.PI / 180), (l - 90) * (Math.PI / 180), !1);
                        q.stroke();
                        q.closePath()
                    });
                    l.bind("pause",
                    function() {
                        d(e).fadeOut(200,
                        function() {
                            q.clearRect(0, 0, 24, 24)
                        })
                    })
                } else {
                    l.addElement("progressbar").appendChild("progress", "progressbar");
                    l.$("progress").addClass("nocanvas");
                    var t = l.$("progress").width();
                    l.bind("progress",
                    function(d) {
                        l.$("progressbar").width(d.percent / 100 * t)
                    })
                }
            })(); (function() {
                if (v) {
                    var e = E.createElement("canvas"),
                    q = e.getContext("2d"),
                    t = Math,
                    z = function(d, e, l) {
                        l = l ? -2 : 2;
                        d.translate(e / l, e / l)
                    },
                    y = 28;
                    d(e).hide().appendTo(l.get("loader")).fadeIn(500);
                    window.setInterval(function() {
                        var d = y,
                        e;
                        q.clearRect(0, 0, 48, 48);
                        q.lineWidth = 1.5;
                        for (var l = 0; l < 28; l++) e = l + d >= 28 ? l - 28 + d: l + d,
                        q.strokeStyle = "rgba(255,255,255," + t.max(0, e / 28) + ")",
                        q.beginPath(),
                        q.moveTo(24, 8),
                        q.lineTo(24, 0),
                        q.stroke(1),
                        z(q, 48, !1),
                        q.rotate(360 / 28 * t.PI / 180),
                        z(q, 48, !0);
                        q.save();
                        z(q, 48, !1);
                        q.rotate( - 1 * (360 / 28 / 8) * t.PI / 180);
                        z(q, 48, !0);
                        y = y === 0 ? 28 : y - 1
                    },
                    20)
                } else l.$("loader").addClass("nocanvas")
            })();
            var q = Galleria.IE < 9 ? {
                bottom: -100
            }: {
                bottom: -50,
                opacity: 0
            },
            F = Galleria.IE < 9 ? {
                top: -20
            }: {
                opacity: 0,
                top: -20
            };
            this.bind("play",
            function() {
                this.$("play").addClass("pause");
                v || this.$("progress").show()
            }).bind("pause",
            function() {
                this.$("play").removeClass("pause");
                v || this.$("progress").hide()
            }).bind("loadstart",
            function(d) {
                d.cached || this.$("loader").show()
            }).bind("loadfinish",
            function() {
                v ? this.$("loader").fadeOut(100) : this.$("loader").hide()
            });
            this.addIdleState(this.get("info"), q, Galleria.IE < 9 ? {}: {
                opacity: 1
            },
            !0).addIdleState(this.get("image-nav-left"), {
                opacity: 0,
                left: 0
            },
            {
                opacity: 1
            },
            !0).addIdleState(this.get("image-nav-right"), {
                opacity: 0,
                right: 0
            },
            {
                opacity: 1
            },
            !0).addIdleState(this.get("counter"), F, Galleria.IE < 9 ? {}: {
                opacity: 0.9
            },
            !0);
            this.$("fullscreen").click(function(d) {
                d.preventDefault();
                l.toggleFullscreen()
            });
            this.$("play").click(function(d) {
                d.preventDefault();
                l.playToggle()
            });
            e._toggleCaption && (this.$("info").addClass("toggler"), this.addElement("captionopen").appendChild("stage", "captionopen"), this.addElement("captionclose").appendChild("info", "captionclose"), this.$("captionopen").click(function() {
                l.$("info").addClass("open");
                d(this).hide()
            }).html(t.show_captions), this.bind("loadstart",
            function() {
                this.$("captionopen").toggle(!l.$("info").hasClass("open") && this.hasInfo())
            }), this.$("captionclose").click(function() {
                l.$("info").removeClass("open");
                l.hasInfo() && l.$("captionopen").show()
            }).html("&#215;"), e._showCaption && this.$("captionopen").click());
            e._showTooltip && this.bindTooltip({
                fullscreen: l.isFullscreen() ? t.exit_fullscreen: t.enter_fullscreen,
                play: function() {
                    return l.isPlaying() ? t.pause: t.play
                },
                captionclose: t.hide_captions,
                "image-nav-right": t.next,
                "image-nav-left": t.prev,
                counter: function() {
                    return t.showing_image.replace(/\%s/, l.getIndex() + 1).replace(/\%s/, l.getDataLength())
                }
            })
        }
    });
    G.make(1, {
        defaults: {
            transition: "pulse",
            transitionSpeed: 500,
            imageCrop: !0,
            thumbCrop: !0,
            carousel: !1,
            _locale: {
                show_thumbnails: "Show thumbnails",
                hide_thumbnails: "Hide thumbnails",
                play: "Play slideshow",
                pause: "Pause slideshow",
                enter_fullscreen: "Enter fullscreen",
                exit_fullscreen: "Exit fullscreen",
                popout_image: "Popout image",
                showing_image: "Showing image %s of %s"
            },
            _showFullscreen: !0,
            _showPopout: !0,
            _showProgress: !0,
            _showTooltip: !0
        },
        init: function(e) {
            Galleria.requires(1.28, "This version of Twelve theme requires Galleria version 1.2.8 or later");
            this.addElement("bar", "fullscreen", "play", "popout", "thumblink", "s1", "s2", "s3", "s4", "progress");
            this.append({
                stage: "progress",
                container: ["bar", "tooltip"],
                bar: ["fullscreen", "play", "popout", "thumblink", "info", "s1", "s2", "s3", "s4"]
            });
            this.prependChild("info", "counter");
            var l = this,
            E = this.$("thumbnails-container"),
            t = this.$("thumblink"),
            v = this.$("fullscreen"),
            q = this.$("play"),
            F = this.$("popout"),
            x = this.$("bar"),
            C = this.$("progress"),
            D = e.transition,
            z = e._locale,
            y = !1,
            O = !1,
            I = !!e.autoplay,
            M = !1,
            U = function() {
                E.height(l.getStageHeight()).width(l.getStageWidth()).css("top", y ? 0 : l.getStageHeight() + 30)
            },
            P = function() {
                y && M ? l.play() : (M = I, l.pause());
                Galleria.utils.animate(E, {
                    top: y ? l.getStageHeight() + 30 : 0
                },
                {
                    easing: "galleria",
                    duration: 400,
                    complete: function() {
                        l.defineTooltip("thumblink", y ? z.show_thumbnails: z.hide_thumbnails);
                        t[y ? "removeClass": "addClass"]("open");
                        y = !y
                    }
                })
            };
            U();
            e._showTooltip && l.bindTooltip({
                thumblink: z.show_thumbnails,
                fullscreen: z.enter_fullscreen,
                play: z.play,
                popout: z.popout_image,
                caption: function() {
                    var d = l.getData(),
                    e = "";
                    d && (d.title && d.title.length && (e += "<strong>" + d.title + "</strong>"), d.description && d.description.length && (e += "<br>" + d.description));
                    return e
                },
                counter: function() {
                    return z.showing_image.replace(/\%s/, l.getIndex() + 1).replace(/\%s/, l.getDataLength())
                }
            });
            e.showInfo || this.$("info").hide();
            this.bind("play",
            function() {
                I = !0;
                q.addClass("playing")
            });
            this.bind("pause",
            function() {
                I = !1;
                q.removeClass("playing");
                C.width(0)
            });
            e._showProgress && this.bind("progress",
            function(d) {
                C.width(d.percent / 100 * this.getStageWidth())
            });
            this.bind("loadstart",
            function(d) {
                d.cached || this.$("loader").show()
            });
            this.bind("loadfinish",
            function() {
                C.width(0);
                this.$("loader").hide();
                this.refreshTooltip("counter", "caption")
            });
            this.bind("thumbnail",
            function(e) {
                d(e.thumbTarget).hover(function() {
                    l.setInfo(e.thumbOrder);
                    l.setCounter(e.thumbOrder)
                },
                function() {
                    l.setInfo();
                    l.setCounter()
                }).click(function() {
                    P()
                })
            });
            this.bind("fullscreen_enter",
            function() {
                O = !0;
                l.setOptions("transition", !1);
                v.addClass("open");
                x.css("bottom", 0);
                this.defineTooltip("fullscreen", z.exit_fullscreen);
                Galleria.TOUCH || this.addIdleState(x, {
                    bottom: -31
                })
            });
            this.bind("fullscreen_exit",
            function() {
                O = !1;
                Galleria.utils.clearTimer("bar");
                l.setOptions("transition", D);
                v.removeClass("open");
                x.css("bottom", 0);
                this.defineTooltip("fullscreen", z.enter_fullscreen);
                Galleria.TOUCH || this.removeIdleState(x, {
                    bottom: -31
                })
            });
            this.bind("rescale", U);
            Galleria.TOUCH || (this.addIdleState(this.get("image-nav-left"), {
                left: -36
            }), this.addIdleState(this.get("image-nav-right"), {
                right: -36
            }));
            t.click(P);
            e._showPopout ? F.click(function(d) {
                l.openLightbox();
                d.preventDefault()
            }) : (F.remove(), e._showFullscreen && (this.$("s4").remove(), this.$("info").css("right", 40), v.css("right", 0)));
            q.click(function() {
                l.defineTooltip("play", I ? z.play: z.pause);
                I ? l.pause() : (y && t.click(), l.play())
            });
            e._showFullscreen ? v.click(function() {
                O ? l.exitFullscreen() : l.enterFullscreen()
            }) : (v.remove(), e._show_popout && (this.$("s4").remove(), this.$("info").css("right", 40), F.css("right", 0))); ! e._showFullscreen && !e._showPopout && (this.$("s3,s4").remove(), this.$("info").css("right", 10));
            e.autoplay && this.trigger("play")
        }
    });
    G.make(2, {
        defaults: {
            transition: "none",
            imageCrop: !0,
            thumbCrop: "height",
            easing: "galleriaOut",
            trueFullscreen: !1,
            _hideDock: !0,
            _closeOnClick: !1
        },
        init: function(e) {
            Galleria.requires(1.28, "This version of Fullscreen theme requires Galleria version 1.2.8 or later");
            this.addElement("thumbnails-tab");
            this.appendChild("thumbnails-container", "thumbnails-tab");
            var l = this.$("thumbnails-tab"),
            E = this.$("loader"),
            t = this.$("thumbnails-container"),
            v = this.$("thumbnails-list"),
            q = this.$("info-text"),
            F = this.$("info"),
            x = !e._hideDock,
            C = 0;
            Galleria.IE && (this.addElement("iefix"), this.appendChild("container", "iefix"), this.$("iefix").css({
                zIndex: 3,
                position: "absolute",
                backgroundColor: "#000",
                opacity: 0.4,
                top: 0
            }));
            e.thumbnails === !1 && t.hide();
            var D = this.proxy(function(e) {
                if (e || e.width) e = Math.min(e.width, d(window).width()),
                q.width(e - 40),
                Galleria.IE && this.getOptions("showInfo") && this.$("iefix").width(F.outerWidth()).height(F.outerHeight())
            });
            this.bind("rescale",
            function() {
                C = this.getStageHeight() - l.height() - 2;
                t.css("top", x ? C - v.outerHeight() + 2 : C);
                var d = this.getActiveImage();
                d && D(d)
            });
            this.bind("loadstart",
            function(e) {
                e.cached || E.show().fadeTo(100, 1);
                d(e.thumbTarget).css("opacity", 1).parent().siblings().children().css("opacity", 0.6)
            });
            this.bind("loadfinish",
            function() {
                E.fadeOut(300);
                this.$("info, iefix").toggle(this.hasInfo())
            });
            this.bind("image",
            function(d) {
                D(d.imageTarget)
            });
            this.bind("thumbnail",
            function(q) {
                d(q.thumbTarget).parent(":not(.active)").children().css("opacity", 0.6);
                d(q.thumbTarget).click(function() {
                    x && e._closeOnClick && l.click()
                })
            });
            this.trigger("rescale");
            Galleria.TOUCH || (this.addIdleState(t, {
                opacity: 0
            }), this.addIdleState(this.get("info"), {
                opacity: 0
            }));
            Galleria.IE && this.addIdleState(this.get("iefix"), {
                opacity: 0
            });
            this.$("image-nav-left, image-nav-right").css("opacity", 0.01).hover(function() {
                d(this).animate({
                    opacity: 1
                },
                100)
            },
            function() {
                d(this).animate({
                    opacity: 0
                })
            }).show();
            e._hideDock ? l.click(this.proxy(function() {
                l.toggleClass("open", !x);
                x ? t.animate({
                    top: C
                },
                400, e.easing) : t.animate({
                    top: C - v.outerHeight() + 2
                },
                400, e.easing);
                x = !x
            })) : (this.bind("thumbnail",
            function() {
                t.css("top", C - v.outerHeight() + 2)
            }), l.css("visibility", "hidden"));
            this.$("thumbnails").children().hover(function() {
                d(this).not(".active").children().stop().fadeTo(100, 1)
            },
            function() {
                d(this).not(".active").children().stop().fadeTo(400, 0.6)
            });
            this.enterFullscreen();
            this.attachKeyboard({
                escape: function() {
                    return ! 1
                },
                up: function(d) {
                    x || l.click();
                    d.preventDefault()
                },
                down: function(d) {
                    x && l.click();
                    d.preventDefault()
                }
            })
        }
    });
    G.make(3, {
        defaults: {
            transition: "slide",
            thumbCrop: "height",
            _toggleInfo: !0
        },
        init: function(e) {
            Galleria.requires(1.28, "This version of Classic theme requires Galleria 1.2.8 or later");
            this.addElement("info-link", "info-close");
            this.append({
                info: ["info-link", "info-close"]
            });
            var l = this.$("info-link,info-close,info-text"),
            E = Galleria.TOUCH,
            t = E ? "touchstart": "click";
            this.$("loader,counter").show().css("opacity", 0.4);
            E || (this.addIdleState(this.get("image-nav-left"), {
                left: -50
            }), this.addIdleState(this.get("image-nav-right"), {
                right: -50
            }), this.addIdleState(this.get("counter"), {
                opacity: 0
            }));
            e._toggleInfo === !0 ? l.bind(t,
            function() {
                l.toggle()
            }) : (l.show(), this.$("info-link, info-close").hide());
            this.bind("thumbnail",
            function(e) {
                E ? d(e.thumbTarget).css("opacity", this.getIndex() ? 1 : 0.6) : (d(e.thumbTarget).css("opacity", 0.6).parent().hover(function() {
                    d(this).not(".active").children().stop().fadeTo(100, 1)
                },
                function() {
                    d(this).not(".active").children().stop().fadeTo(400, 0.6)
                }), e.index === this.getIndex() && d(e.thumbTarget).css("opacity", 1))
            });
            this.bind("loadstart",
            function(e) {
                e.cached || this.$("loader").show().fadeTo(200, 0.4);
                this.$("info").toggle(this.hasInfo());
                d(e.thumbTarget).css("opacity", 1).parent().siblings().children().css("opacity", 0.6)
            });
            this.bind("loadfinish",
            function() {
                this.$("loader").fadeOut(200)
            })
        }
    });
    G.make(4, {
        defaults: {
            transition: "pulse",
            thumbCrop: "width",
            imageCrop: !1,
            carousel: !1,
            show: !1,
            easing: "galleriaOut",
            fullscreenDoubleTap: !1,
            trueFullscreen: !1,
            _webkitCursor: !1,
            _animate: !0
        },
        init: function(e) {
            Galleria.requires(1.28, "This version of Folio theme requires Galleria version 1.2.8 or later");
            this.addElement("preloader", "loaded", "close").append({
                container: "preloader",
                preloader: "loaded",
                stage: "close"
            });
            var l = this,
            E = this.$("stage"),
            t = this.$("thumbnails");
            this.$("images");
            var v = this.$("info"),
            q = this.$("loader"),
            F = this.$("target"),
            x = 0,
            C = F.width(),
            D = 0,
            z = window.location.hash.substr(2),
            y = function(e) {
                l.$("info").css({
                    left: Math.max(20, d(window).width() / 2 - e / 2 + 10),
                    marginBottom: l.getData().video ? 40 : 0
                })
            },
            O = function(e, l) {
                var l = d.extend({
                    speed: 400,
                    width: 190,
                    onbrick: function() {},
                    onheight: function() {},
                    delay: 0,
                    debug: !1
                },
                l),
                e = d(e),
                q = e.children(),
                t = e.width(),
                x = Math.floor(t / l.width),
                z = [],
                v,
                y,
                C,
                t = {
                    "float": "none",
                    position: "absolute",
                    display: d.browser.safari ? "inline-block": "block"
                };
                if (e.data("colCount") !== x && (e.data("colCount", x), q.length)) {
                    for (v = 0; v < x; v++) z[v] = 0;
                    e.css("position", "relative");
                    q.css(t).each(function(e, q) {
                        q = d(q);
                        for (v = x - 1; v > -1; v--) z[v] === Math.min.apply(window, z) && (y = v);
                        C = {
                            top: z[y],
                            left: l.width * y
                        };
                        typeof C.top !== "number" || typeof C.left !== "number" || (l.speed ? window.setTimeout(function(d, e, l) {
                            return function() {
                                Galleria.utils.animate(d, l, {
                                    easing: "galleriaOut",
                                    duration: e.speed,
                                    complete: e.onbrick
                                })
                            }
                        } (q, l, C), e * l.delay) : (q.css(C), l.onbrick.call(q)), q.data("height") || q.data("height", q.outerHeight(!0)), z[y] += q.data("height"))
                    });
                    q = Math.max.apply(window, z); ! (q < 0) && typeof q === "number" && (l.speed ? e.animate({
                        height: Math.max.apply(window, z)
                    },
                    l.speed, l.onheight) : (e.height(Math.max.apply(window, z)), l.onheight.call(e)))
                }
            };
            this.bind("fullscreen_enter",
            function() {
                this.$("container").css("height", "100%")
            });
            this.bind("fullscreen_exit",
            function() {
                this.getData().iframe && (d(this._controls.getActive().container).find("iframe").remove(), this.$("container").removeClass("iframe"));
                v.hide();
                d(l._controls.getActive().container).hide();
                t.show();
                E.css("left", -1E4)
            });
            this.bind("loadstart",
            function(d) {
                Galleria.TOUCH && this.$("image-nav").toggle( !! d.galleriaData.iframe)
            });
            this.bind("thumbnail",
            function(q) {
                this.addElement("plus");
                Galleria.History && q.index === parseInt(z, 10) && this.enterFullscreen(function() {
                    this.show(z)
                });
                var v = q.thumbTarget,
                y = this.$("plus").css({
                    display: "block"
                }).insertAfter(v),
                C = d(v).parent().data("index", q.index);
                e.showInfo && this.hasInfo(q.index) && y.append("<span>" + this.getData(q.index).title + "</span>");
                D = D || d(v).parent().outerWidth(!0);
                d(v).css("opacity", 0);
                C.unbind(e.thumbEventType);
                Galleria.IE ? y.hide() : y.css("opacity", 0);
                Galleria.TOUCH ? C.bind("touchstart",
                function() {
                    y.css("opacity", 1)
                }).bind("touchend",
                function() {
                    y.hide()
                }) : C.hover(function() {
                    Galleria.IE ? y.show() : y.stop().css("opacity", 1)
                },
                function() {
                    Galleria.IE ? y.hide() : y.stop().animate({
                        opacity: 0
                    },
                    300)
                });
                x++;
                this.$("loaded").css("width", x / this.getDataLength() * 100 + "%");
                x === this.getDataLength() && (this.$("preloader").fadeOut(100), t.data("colCount", null), O(t, {
                    width: D,
                    speed: e._animate ? 400 : 0,
                    onbrick: function() {
                        var q = d(this).find("img");
                        window.setTimeout(function(q) {
                            return function() {
                                Galleria.utils.animate(q, {
                                    opacity: 1
                                },
                                {
                                    duration: e.transition_speed
                                });
                                q.parent().unbind("mouseup click").bind(Galleria.TOUCH ? "mouseup": "click",
                                function() {
                                    t.hide();
                                    E.css("left", 0);
                                    var e = d(this).data("index");
                                    l.enterFullscreen(function() {
                                        l.show(e)
                                    })
                                })
                            }
                        } (q), e._animate ? q.parent().data("index") * 100 : 0)
                    },
                    onheight: function() {
                        F.height(t.height())
                    }
                }))
            });
            this.bind("loadstart",
            function(d) {
                d.cached || q.show()
            });
            this.bind("data",
            function() {
                x = 0
            });
            this.bind("loadfinish",
            function(l) {
                q.hide();
                v.hide();
                this.hasInfo() && e.showInfo && this.isFullscreen() && v.fadeIn(e.transition ? e.transitionSpeed: 0);
                y(d(l.imageTarget).width())
            }); ! Galleria.TOUCH && !e._webkitCursor && (this.addIdleState(this.get("image-nav-left"), {
                left: -100
            }), this.addIdleState(this.get("image-nav-right"), {
                right: -100
            }), this.addIdleState(this.get("info"), {
                opacity: 0
            }));
            this.$("container").css({
                width: e.width,
                height: "auto"
            });
            e._webkitCursor && Galleria.WEBKIT && !Galleria.TOUCH && this.$("image-nav-right,image-nav-left").addClass("cur");
            Galleria.TOUCH && this.setOptions({
                transition: "fadeslide",
                initialTransition: !1
            });
            this.$("close").click(function() {
                l.exitFullscreen()
            });
            d(window).resize(function() {
                if (l.isFullscreen()) l.getActiveImage() && y(l.getActiveImage().width);
                else {
                    var d = F.width();
                    d !== C && (C = d, O(t, {
                        width: D,
                        delay: 50,
                        debug: !0,
                        onheight: function() {
                            F.height(t.height())
                        }
                    }))
                }
            })
        }
    });
    G.make(5, {
        defaults: {
            transition: "pulse",
            thumbCrop: !0,
            imageCrop: !0,
            carousel: !1,
            imagePan: !0,
            clicknext: !0,
            _locale: {
                enter_fullscreen: "Enter fullscreen",
                exit_fullscreen: "Exit fullscreen",
                click_to_close: "Click to close",
                show_thumbnails: "Show thumbnails",
                show_info: "Show info"
            }
        },
        init: function(e) {
            Galleria.requires(1.28, "This version of Miniml theme requires Galleria version 1.2.8 or later");
            var l = this,
            E = !1,
            t;
            t = 0;
            var v, q, F;
            this.addElement("desc", "dots", "thumbs", "fs", "more");
            this.append({
                container: ["desc", "dots", "thumbs", "fs", "info-description", "more"]
            });
            F = this.$("thumbnails-container").hide().css("visibility", "visible");
            var x = function(e) {
                return d("<div>").click(function(d) {
                    return function(e) {
                        e.preventDefault();
                        l.show(d)
                    }
                } (e))
            };
            for (t = 0; t < this.getDataLength(); t++) this.$("dots").append(x(t));
            t = this.$("dots").outerWidth();
            v = this.$("desc").hide().hover(function() {
                d(this).addClass("hover")
            },
            function() {
                d(this).removeClass("hover")
            }).click(function() {
                d(this).hide()
            });
            q = this.$("loader");
            this.bindTooltip({
                fs: function() {
                    return E ? e._locale.exit_fullscreen: e._locale.enter_fullscreen
                },
                desc: e._locale.click_to_close,
                more: e._locale.show_info,
                thumbs: e._locale.show_thumbnails
            });
            this.bind("loadstart",
            function(d) {
                d.cached || this.$("loader").show().fadeTo(200, 0.4)
            });
            this.bind("loadfinish",
            function(d) {
                var t = l.getData().title,
                x = l.getData().description;
                v.hide();
                q.fadeOut(200);
                this.$("dots").children("div").eq(d.index).addClass("active").siblings(".active").removeClass("active");
                t && x ? (v.empty().append("<strong>" + t + "</strong>", "<p>" + x + "</p>").css({
                    marginTop: this.$("desc").outerHeight() / -2
                }), this.$("more").show()) : this.$("more").hide();
                F.fadeOut(e.fadeSpeed);
                l.$("thumbs").removeClass("active")
            });
            this.bind("thumbnail",
            function(e) {
                d(e.thumbTarget).hover(function() {
                    l.setInfo(e.index)
                },
                function() {
                    l.setInfo()
                })
            });
            this.$("fs").click(function() {
                l.toggleFullscreen();
                E = !E
            });
            this.$("thumbs").click(function(e) {
                e.preventDefault();
                F.toggle();
                d(this).toggleClass("active");
                v.hide()
            });
            this.$("more").click(function() {
                v.toggle()
            });
            this.$("info").css({
                width: this.getStageWidth() - t - 30,
                left: t + 10
            })
        }
    })
})(jQuery); (function(d) {
    var e = this,
    l = function(d) {
        var l = e.location,
        t, v;
        if (/^\w+:/.test(d)) return d.toString();
        t = l.protocol + "//" + l.host;
        if (d.indexOf("/") === 0) return t + d.toString();
        l = l.pathname.replace(/\/[^\/]*$/, "");
        if (v = d.match(/\.\.\//g)) {
            d = d.substring(v.length * 3);
            for (v = v.length; v--;) l = l.substring(0, l.lastIndexOf("/"))
        } else d = d.toString();
        return t + l + "/" + d
    },
    E = function(d, e) {
        var l;
        if (d.length !== e.length) return ! 1;
        for (l = 0; l < e.length; l++) if (d[l] !== e[l]) return ! 1;
        return ! 0
    },
    t = function(d) {
        return d.replace(/#.*$/, "").replace(/\?.*/, "").replace(/\/$/, "")
    },
    v = t(e.location.href).split("/");
    d.extend(d.expr[":"], {
        path: function(d) {
            if (! (d.href && d.nodeName.toUpperCase() === "A")) return ! 1;
            d = t(l(d.href)).split("/");
            if (d.length === 3) return E(v, d);
            return v.length < d.length ? !1 : E(v.slice(0, d.length), d)
        },
        current: function(d) {
            if (! (d.href && d.nodeName.toUpperCase() === "A")) return ! 1;
            d = t(l(d.href)).split("/");
            return E(v, d)
        }
    })
})(jQuery);